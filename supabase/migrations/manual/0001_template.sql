-- Manual Migration Template
-- Number: 0001
-- Title: <–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏>
-- Owner: <–∏–º—è –∏ –∫–æ–º–∞–Ω–¥–∞>
-- Date: <YYYY-MM-DD>
-- Reason: –û–ø–∏—à–∏—Ç–µ, –ø–æ—á–µ–º—É –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π backfill, –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–æ—Ç—Ñ–∏–∫—Å, –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã).

-- =====================
-- üöß PRE-CHECKS
-- =====================
-- 1. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø –±–∞–∑—ã.
-- 2. –°–æ–≥–ª–∞—Å—É–π—Ç–µ –æ–∫–Ω–æ –∑–∞–ø—É—Å–∫–∞ –∏ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π.
-- 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ staging.

BEGIN;

-- =====================
-- üõ†Ô∏è EXECUTION STEPS
-- =====================
-- TODO: –∑–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ SQL-–∫–æ–º–∞–Ω–¥—ã.
-- UPDATE public.tracks SET status = 'archived' WHERE created_at < '2024-01-01';

-- =====================
-- üîç VALIDATION
-- =====================
-- SELECT status, COUNT(*) FROM public.tracks GROUP BY status;

-- =====================
-- ‚ôªÔ∏è ROLLBACK PLAN
-- =====================
-- –û–ø–∏—à–∏—Ç–µ, –∫–∞–∫ –≤–µ—Ä–Ω—É—Ç—å —Å–∏—Å—Ç–µ–º—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.
-- –ù–∞–ø—Ä–∏–º–µ—Ä: UPDATE public.tracks SET status = 'processing' WHERE status = 'archived' AND updated_at >= now() - interval '5 minutes';

COMMIT;

-- –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Ä–∞–∑–±–∏—Ç—å –∏—Ö –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫.
