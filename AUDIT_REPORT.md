# Комплексный Аудит Проекта и План Восстановления

**Дата:** 26 ноября 2025 г.
**Исполнитель:** Жюль, AI-инженер

## 1. Резюме

Проведен комплексный аудит проекта "Albert3 Muse Synth Studio". Анализ показал, что проект имеет прочную и современную архитектурную основу (React, TypeScript, Supabase, модульная структура), но страдает от значительных расхождений между реализованной в коде бизнес-логикой и функционалом, доступным в пользовательском интерфейсе.

Были обнаружены многочисленные случаи "потерянного" функционала — от критически важных для пользователя возможностей (отображение баланса, экспорт) до тонких настроек, которые не были выведены в UI.

Данный документ представляет детальные выводы аудита и предлагает структурированный план по восстановлению и дальнейшему развитию проекта.

## 2. Методология Аудита

Аудит проводился в три этапа:
1.  **Анализ файловой структуры:** Изучение ключевых директорий (`components`, `hooks`, `pages`, `services`) для составления карты архитектуры и зависимостей.
2.  **Аудит ключевых функций:** Глубокий анализ кода основных страниц (`Generate`, `Library`, `Stem Studio`) для выявления несоответствий между UI и реализованной логикой.
3.  **Проверка интеграции с API:** Сопоставление реализованных методов в адаптере `suno.adapter.ts` с элементами управления в компоненте `MusicGeneratorContainer.tsx`.

## 3. Детальные Выводы

### 3.1. Страница "Библиотека" (`Library.tsx`)

Ключевой раздел управления треками содержит несколько критических упущений, которые напрямую влияют на пользовательский опыт, особенно для активных пользователей.

-   **"Потерянный" функционал в виртуализированной сетке:**
    -   **Проблема:** Когда количество треков превышает 50, включается режим виртуализации (`VirtualizedTrackGrid`). В этот компонент **не передаются** обработчики для следующих действий: улучшение аудио (`handleUpscaleAudio`), генерация обложки (`handleGenerateCover`), переключение версий (`handleSwitchVersion`) и получение AI-описания трека (`handleDescribeTrack`).
    -   **Влияние:** Пользователи с большими библиотеками теряют доступ к четырем важным AI-функциям в режиме "сетка".
    -   **Локация:** `src/pages/workspace/Library.tsx`

-   **Неинтерактивный "Оптимизированный" вид:**
    -   **Проблема:** В интерфейсе есть переключатель на "Оптимизированный" вид (`OptimizedTrackList`), однако в этот компонент **не передается ни один обработчик действий** (воспроизведение, удаление и т.д.).
    -   **Влияние:** Данный режим отображения абсолютно бесполезен для пользователя, так как является "read-only".
    -   **Локация:** `src/pages/workspace/Library.tsx`

### 3.2. Страница "Stem Studio" (`StemStudio.tsx`)

Новый и важный раздел, согласно `README.md`, не реализует одну из своих ключевых заявленных функций.

-   **Отсутствует функция "Использовать стем как референс":**
    -   **Проблема:** В `README.md` заявлена возможность использовать любой стем как референс для новой генерации. Однако в UI (`StudioHeader.tsx`, `StudioControls.tsx`) **отсутствует какой-либо элемент управления** (кнопка, пункт меню) для выполнения этого действия.
    -   **Влияние:** Пользователи не могут воспользоваться одной из самых мощных функций "Студии", что снижает ее ценность.
    -   **Локация:** `src/features/studio/components/`

### 3.3. Интеграция с Suno API (`MusicGeneratorContainer.tsx`)

Интеграция с Suno API реализована на уровне сервисов, но значительная часть ее возможностей не доступна пользователю.

-   **"Потерянные" параметры тонкой настройки генерации:**
    -   **Проблема:** Адаптер `suno.adapter.ts` поддерживает расширенные параметры генерации, такие как `negativeTags`, `weirdnessConstraint`, `styleWeight`, `lyricsWeight` и `audioWeight`. Однако в форме генерации (`MusicGeneratorContainer.tsx` и его дочерних компонентах) **отсутствуют элементы управления** (слайдеры, поля ввода) для этих параметров.
    -   **Влияние:** Пользователи лишены возможности тонко настраивать процесс генерации, что ограничивает их креативный контроль и является стандартом для подобных сервисов.
    -   **Локация:** `src/components/generator/`

-   **Неиспользуемая функция получения баланса:**
    -   **Проблема:** В `suno.adapter.ts` реализован метод `getBalance()` для получения информации об оставшихся кредитах. Однако **ни один компонент в приложении не вызывает этот метод** и не отображает баланс пользователю.
    -   **Влияние:** Это критическое упущение в UX. Пользователи не знают, сколько у них осталось попыток генерации, что может привести к неожиданному исчерпанию лимита и негативному опыту.
    -   **Локация:** `suno.adapter.ts`, отсутствие вызова в UI.

### 3.4. Функции-"Заглушки"

Были обнаружены функции, которые подключены к UI, но их реализация представляет собой просто вывод в консоль (`console.log`). Это запланированный, но нереализованный функционал.

-   `handleSwitchVersion` (в `Library.tsx`)
-   `handleDescribeTrack` (в `Library.tsx`)

## 4. План Восстановления

Предлагается следующий план действий, приоритезированный по степени критичности и влияния на пользовательский опыт.

### **P1: Критические исправления (максимальный приоритет)**

*   **Задача 1.1: Отобразить баланс кредитов Suno.**
    -   **Действия:** Создать компонент (например, `UserBalance.tsx`) в `Header` или `Sidebar`, который будет использовать хук `useQuery` для вызова функции `getBalance()` из `suno.adapter.ts` и отображать результат пользователю.
    -   **Обоснование:** Это критически важная информация для пользователя, влияющая на его взаимодействие с сервисом.

*   **Задача 1.2: Сделать "Оптимизированный" вид в Библиотеке интерактивным.**
    -   **Действия:** Передать необходимые обработчики (`onPlay`, `onDelete` и т.д.) в компонент `OptimizedTrackList` или временно скрыть этот вид из UI, если он не готов.
    -   **Обоснование:** Нефункциональные элементы интерфейса вводят пользователя в заблуждение и создают впечатление "сырого" продукта.

### **P2: Восстановление основного функционала (высокий приоритет)**

*   **Задача 2.1: Восстановить действия в виртуализированной сетке Библиотеки.**
    -   **Действия:** Пробросить недостающие обработчики (`onUpscaleAudio`, `onGenerateCover` и т.д.) в компонент `VirtualizedTrackGrid` в `Library.tsx`.
    -   **Обоснование:** Восстанавливает полный функционал для пользователей с большими библиотеками.

*   **Задача 2.2: Реализовать UI для функции "Использовать стем как референс".**
    -   **Действия:** Добавить кнопку "Use as Reference" в `StemTrackList` для каждого стема. При нажатии, эта кнопка должна будет программно перенаправлять пользователя на страницу `Generate` и заполнять форму, используя аудио-URL стема в качестве `referenceAudioUrl`.
    -   **Обоснование:** Реализация одной из ключевых заявленных функций "Stem Studio".

### **P3: Расширение функционала и UX (средний приоритет)**

*   **Задача 3.1: Вывести в UI параметры тонкой настройки генерации.**
    -   **Действия:** Добавить в "Custom Mode" на странице `Generate` секцию "Advanced Settings" со слайдерами или полями ввода для `weirdnessConstraint`, `styleWeight` и других "потерянных" параметров.
    -   **Обоснование:** Предоставляет "продвинутым" пользователям больший контроль над генерацией.

*   **Задача 3.2: Реализовать функции-"заглушки".**
    -   **Действия:** Написать логику для функций `handleSwitchVersion` и `handleDescribeTrack`.
    -   **Обоснование:** Завершение ранее запланированного функционала.

Этот план позволит нам систематически устранить все обнаруженные проблемы, значительно улучшить пользовательский опыт и привести приложение в соответствие с его заявленными возможностями.
