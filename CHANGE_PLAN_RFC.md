# RFC: План итеративных улучшений Albert3 Muse Synth Studio

> **Статус:** Предложение
> **Авторы:** Chief Full-Stack & UX Auditor
> **Дата:** 2025-11-03

## 1. Обзор

Этот документ предлагает пошаговый план по улучшению ключевых аспектов проекта: UI/UX, CI/CD, безопасность и DevEx. Каждое изменение спроектировано как инкрементальное и обратимое.

## 2. Ключевые архитектурные решения (ADR)

### ADR-001: Внедрение системы дизайн-токенов (SSOT для UI)

*   **Контекст:** Цвета, отступы и типографика определены в `tailwind.config.js`, что затрудняет поддержку и согласованность.
*   **Решение:**
    1.  Создать единый источник истины для дизайн-токенов в `src/styles/tokens.json`.
    2.  Интегрировать `tokens.json` с TailwindCSS через плагин или скрипт сборки.
    3.  Обеспечить доступ к токенам в TypeScript и CSS.
*   **Обоснование:** Это создаст настоящий SSOT для дизайн-системы, упростит поддержку тем и ускорит разработку UI.

### ADR-002: Автоматизация "ворот качества" в CI

*   **Контекст:** Метрики производительности, доступности и размера бандла проверяются вручную, что ненадежно.
*   **Решение:**
    1.  Добавить в CI-пайплайн шаг для запуска Lighthouse и `npx bundle-buddy`.
    2.  Установить пороговые значения (бюджеты) для ключевых метрик.
    3.  CI будет блокировать merge-реквесты, нарушающие бюджеты.
*   **Обоснование:** Гарантирует стабильно высокое качество продукта и предотвращает регрессии.

## 3. Поэтапный план изменений

### Этап 1: Фундамент и быстрые победы (1-2 спринта)

| Шаг | Цель | Затронутые файлы/пакеты | Риск | План отката |
| :--- | :--- | :--- | :--- | :--- |
| **1.1** | Обновление зависимостей | `package.json`, `package-lock.json` | **Средний** | Откатить `package-lock.json` и переустановить зависимости. |
| **1.2** | Внедрение дизайн-токенов (JSON) | `src/styles/tokens.json`, `tailwind.config.js` | **Низкий** | Отключить плагин токенов в конфиге Tailwind. |
| **1.3** | Добавление Axe в E2E-тесты | `tests/e2e/` | **Низкий** | Закомментировать вызовы Axe в тестах. |

### Этап 2: Автоматизация и CI (2-3 спринта)

| Шаг | Цель | Затронутые файлы/пакеты | Риск | План отката |
| :--- | :--- | :--- | :--- | :--- |
| **2.1** | Интеграция Lighthouse в CI | `.github/workflows/ci.yml` | **Средний** | Отключить шаг Lighthouse в CI. Использовать `feature flag` для нового шага. |
| **2.2** | Настройка бюджетов бандла | `package.json` (скрипт), `.github/workflows/ci.yml` | **Низкий** | Увеличить бюджет или временно отключить проверку. |
| **2.3** | Внедрение валидации ENV (Zod) | `src/config/env.ts`, `vite.config.ts` | **Низкий** | Убрать вызов валидации. |

### Этап 3: Улучшение DevEx и рефакторинг (3-4 спринта)

| Шаг | Цель | Затронутые файлы/пакеты | Риск | План отката |
| :--- | :--- | :--- | :--- | :--- |
| **3.1** | Стабилизация E2E-тестов | `tests/e2e/`, `docker-compose.e2e.yml` (новый) | **Высокий** | Использовать старый скрипт запуска тестов. |
| **3.2** | Рефакторинг импортов | `src/` (все файлы) | **Средний** | Постепенный рефакторинг по модулям, откатывать изменения через Git. |
| **3.3** | Внедрение CSP и SRI | `index.html`, `vite.config.ts` | **Высокий** | Отключить генерацию CSP/SRI в конфиге Vite. |
