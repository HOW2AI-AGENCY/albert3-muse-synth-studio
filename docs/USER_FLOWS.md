# üßë‚ÄçüöÄ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

–í —ç—Ç–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ –æ–ø–∏—Å–∞–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (User Flows), –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

## 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç, –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É –∏ –≤—ã–π—Ç–∏ –∏–∑ –Ω–µ–µ.
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** Supabase Auth.
- **–ü—Ä–æ—Ü–µ—Å—Å:**
    1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
    2. –í–≤–æ–¥–∏—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (email/–ø–∞—Ä–æ–ª—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞).
    3. Supabase Auth –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Å—Å–∏—é –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω.
    4. –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API.

## 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –º—É–∑—ã–∫—É –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é.
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React, Supabase Edge Functions, Suno API, Supabase DB, Supabase Storage, Supabase Realtime.
- **–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```mermaid
sequenceDiagram
    participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant FE as Frontend (React App)
    participant Supabase as Supabase Client
    participant EdgeFunc as Edge Function (generate-suno)
    participant Suno as Suno API
    participant DB as Supabase DB
    participant Storage as Supabase Storage

    User->>FE: –í–≤–æ–¥–∏—Ç –ø—Ä–æ–º–ø—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"
    FE->>Supabase: –í—ã–∑—ã–≤–∞–µ—Ç functions.invoke('generate-suno', { ... })
    Supabase->>EdgeFunc: –ü–µ—Ä–µ–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å —Å JWT –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    EdgeFunc->>DB: –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `tracks` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'pending'
    DB-->>EdgeFunc: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –Ω–æ–≤–æ–≥–æ —Ç—Ä–µ–∫–∞
    
    EdgeFunc->>Suno: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é (POST /api/generate)
    Suno-->>EdgeFunc: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç ID –∑–∞–¥–∞—á–∏ (task_id)
    
    EdgeFunc->>DB: –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç—Ä–µ–∫, –¥–æ–±–∞–≤–ª—è—è `suno_task_id` –∏ —Å—Ç–∞—Ç—É—Å 'processing'
    EdgeFunc-->>Supabase: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { success: true, trackId: ... }
    Supabase-->>FE: –£–≤–µ–¥–æ–º–ª—è–µ—Ç UI –æ –Ω–∞—á–∞–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    
    alt –ü–æ–ª–ª–∏–Ω–≥ (–µ—Å–ª–∏ Callback URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
        loop –ö–∞–∂–¥—ã–µ 5-10 —Å–µ–∫—É–Ω–¥
            EdgeFunc->>Suno: –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏ (GET /api/task/<task_id>)
            Suno-->>EdgeFunc: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å ('processing' –∏–ª–∏ 'completed')
        end
    end

    Suno->>EdgeFunc: (–ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –Ω–∞ Callback URL, –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤–æ

    EdgeFunc->>Suno: –ü–æ–ª—É—á–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å 'completed' –∏ URL-—ã
    EdgeFunc->>Storage: –°–∫–∞—á–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ –∏ –æ–±–ª–æ–∂–∫—É —Å URL-–æ–≤ Suno
    Storage-->>EdgeFunc: –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ Supabase Storage –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ URL
    
    EdgeFunc->>DB: –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å —Ç—Ä–µ–∫–∞: —Å—Ç–∞—Ç—É—Å 'completed', URL-—ã –∞—É–¥–∏–æ/–æ–±–ª–æ–∂–∫–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    
    FE->>DB: (–ß–µ—Ä–µ–∑ –ø–æ–¥–ø–∏—Å–∫—É Supabase Realtime) –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–µ–∫–∞
    FE->>User: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ç—Ä–µ–∫ –≤ —Å–ø–∏—Å–∫–µ
```

## 3. –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞–º–∏

- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö —Ç—Ä–µ–∫–æ–≤, –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å –∏—Ö, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∏ —É–¥–∞–ª—è—Ç—å.
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** React, Supabase DB, Supabase Storage, Audio Player component.
- **–ü—Ä–æ—Ü–µ—Å—Å:**
    1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–≤–æ–∏—Ö —Ç—Ä–µ–∫–æ–≤.
    2. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É Supabase DB —Å–ø–∏—Å–æ–∫ —Ç—Ä–µ–∫–æ–≤ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    3. –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞.
    4. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "Play", URL –∞—É–¥–∏–æ-—Ñ–∞–π–ª–∞ –∏–∑ Supabase Storage –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä–∞.
    5. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–µ–∫–∞, —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ Supabase (—á–µ—Ä–µ–∑ Edge Function –∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é), –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ –ë–î –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–∑ Storage.