# üéπ Music Studio ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–±–∑–æ—Ä

**Music Studio** ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π —Ä–∞–±–æ—Ç—ã —Å –º—É–∑—ã–∫–æ–π, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è —Ç—Ä–∏ –º–æ—â–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

1. **MiniMax Music-1.5** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –ø–µ—Å–µ–Ω (–¥–æ 4 –º–∏–Ω—É—Ç)
2. **AudioSR** ‚Äî AI-–∞–ø—Å–µ–º–ø–ª–∏–Ω–≥ –∞—É–¥–∏–æ –¥–æ 48kHz
3. **Prompt DJ** ‚Äî —Ä–µ–∞–ª—Ç–∞–π–º-–º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤

## üéõÔ∏è –í–∫–ª–∞–¥–∫–∏ Studio

### 1. MiniMax Generator

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏ —Å –≤–æ–∫–∞–ª–æ–º —á–µ—Ä–µ–∑ MiniMax Music-1.5 (Replicate API)

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- üéµ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ 4 –º–∏–Ω—É—Ç
- üé§ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–æ–∫–∞–ª
- üéπ –ë–æ–≥–∞—Ç–∞—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤–∫–∞
- üìù –ü–æ–¥–¥–µ—Ä–∂–∫–∞ lyrics (10-600 —Å–∏–º–≤–æ–ª–æ–≤)
- üé® Reference audio –¥–ª—è —Å—Ç–∏–ª—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –õ–∏–º–∏—Ç—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|---------|----------|
| **Prompt** | ‚úÖ | 10-300 —Å–∏–º–≤–æ–ª–æ–≤ | –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∏–ª—è, –∂–∞–Ω—Ä–∞, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è |
| **Lyrics** | ‚úÖ | 10-600 —Å–∏–º–≤–æ–ª–æ–≤ | –¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–≥–æ–≤ |
| **Reference Audio URL** | ‚ùå | ‚Äî | –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–π —Ç—Ä–µ–∫ |
| **Style Strength** | ‚ùå | 0.0-1.0 | –í–ª–∏—è–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω) |
| **Sample Rate** | ‚ùå | 44100 Hz | –ß–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ |
| **Bitrate** | ‚ùå | 256 kbps | –ë–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ |
| **Audio Format** | ‚ùå | mp3/wav | –§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–∞ |

**–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–≥–æ–≤ –≤ Lyrics:**
```
[intro]
Opening instrumental

[verse]
First verse lyrics here
Another line

[chorus]
Hook lyrics
Catchy part

[bridge]
Bridge section

[outro]
Ending part
```

**–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤:**

```typescript
// Blues
{
  prompt: "blues, melancholic, raw, lonely bar, heartbreak",
  lyrics: "[verse]\nDim lights on a dusty floor\n[chorus]\nOh these barroom blues"
}

// Alt-Pop
{
  prompt: "Fast paced alt-pop with ragga breaks, Tempo 120-135 BPM, glitch pop, y2k-inspired",
  lyrics: "[verse 1]\nStuck in my head but I feel better\n[chorus]\nI put on my gold jacket"
}

// Jazz
{
  prompt: "Jazz, Smooth Jazz, Romantic, Dreamy",
  lyrics: "[Verse]\nIn the hush of night, we find our space\n[Bridge]\nYour voice, a lullaby"
}
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫:**

```mermaid
sequenceDiagram
    participant User
    participant UI as MinimaxGenerator
    participant Hook as useMinimaxGeneration
    participant EdgeFn as generate-minimax
    participant Replicate as Replicate API

    User->>UI: Fill form (prompt + lyrics)
    User->>UI: Click "Generate Music"
    UI->>Hook: mutate(params)
    Hook->>EdgeFn: POST /functions/v1/generate-minimax
    EdgeFn->>EdgeFn: Validate params
    EdgeFn->>Replicate: replicate.run('minimax/music-1.5')
    Replicate-->>EdgeFn: { audioUrl: "https://..." }
    EdgeFn-->>Hook: { success: true, audioUrl }
    Hook-->>UI: onSuccess ‚Üí setGeneratedAudio
    UI->>User: Display audio player + download button
```

---

### 2. Audio Upscaler

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** AI-–∞–ø—Å–µ–º–ø–ª–∏–Ω–≥ –∞—É–¥–∏–æ –¥–æ 48kHz —á–µ—Ä–µ–∑ AudioSR

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚ú® –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∞—É–¥–∏–æ
- üìà Upsampling –¥–æ 48 kHz
- üéöÔ∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (truncated batches)
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ DDIM steps –∏ Guidance Scale

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –õ–∏–º–∏—Ç—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|---------|----------|
| **Input URL** | ‚úÖ | ‚Äî | –°—Å—ã–ª–∫–∞ –Ω–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª (MP3/WAV/M4A) |
| **DDIM Steps** | ‚ùå | 10-100 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ |
| **Guidance Scale** | ‚ùå | 1.0-10.0 | Classifier-free guidance |
| **Truncated Batches** | ‚ùå | true | –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (>5.12s) |

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫:**

```mermaid
sequenceDiagram
    participant User
    participant UI as AudioUpscaler
    participant Hook as useAudioUpscale
    participant StatusHook as useAudioUpscaleStatus
    participant EdgeFn as upscale-audio-sr
    participant Replicate

    User->>UI: Enter audio URL
    User->>UI: Click "Upscale Audio"
    UI->>Hook: mutate({ inputFileUrl, ... })
    Hook->>EdgeFn: POST /functions/v1/upscale-audio-sr
    EdgeFn->>Replicate: predictions.create()
    Replicate-->>EdgeFn: { predictionId, status: 'starting' }
    EdgeFn-->>Hook: { success: true, predictionId }
    Hook-->>UI: onSuccess ‚Üí setPredictionId

    loop Polling (every 2s)
        StatusHook->>EdgeFn: Check status (predictionId)
        EdgeFn->>Replicate: predictions.get(predictionId)
        Replicate-->>EdgeFn: { status: 'processing' }
        EdgeFn-->>StatusHook: status data
        StatusHook-->>UI: Update progress
    end

    Replicate-->>EdgeFn: { status: 'succeeded', output: "https://..." }
    EdgeFn-->>StatusHook: Final status
    StatusHook-->>UI: setUpscaledUrl
    UI->>User: Display audio + download WAV
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
- `starting` ‚Üí –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- `processing` ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è Progress bar)
- `succeeded` ‚Üí –ì–æ—Ç–æ–≤–æ (audio player + download)
- `failed` ‚Üí –û—à–∏–±–∫–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ)

---

### 3. Prompt DJ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∞–ª—Ç–∞–π–º-–º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ —Å Gemini Lyria API

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. `docs/PROMPT_DJ_GUIDE.md`

**–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:**
- üéõÔ∏è 16 –ø—Ä–æ–º–ø—Ç-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- üîÑ –†–µ–∞–ª—Ç–∞–π–º-–º–∏–∫—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
- üéß WebSocket —Å—Ç—Ä–∏–º–∏–Ω–≥

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend (Edge Functions)

**1. generate-minimax**

```typescript
// supabase/functions/generate-minimax/index.ts

interface MinimaxGenerationRequest {
  prompt: string;           // 10-300 chars
  lyrics: string;          // 10-600 chars
  referenceAudioUrl?: string;
  styleStrength?: number;  // 0-1
  sampleRate?: number;     // default 44100
  bitrate?: number;        // default 256000
  audioFormat?: 'mp3' | 'wav';
}

// Returns:
{
  success: true,
  audioUrl: "https://replicate.delivery/...",
  prompt: "...",
  lyrics: "..."
}
```

**2. upscale-audio-sr**

```typescript
// supabase/functions/upscale-audio-sr/index.ts

interface AudioUpscaleRequest {
  inputFileUrl: string;
  truncatedBatches?: boolean; // default true
  ddimSteps?: number;        // default 50
  guidanceScale?: number;    // default 3.5
  seed?: number;
  predictionId?: string;     // For status check
}

// Returns (initial):
{
  success: true,
  predictionId: "abc123...",
  status: "starting"
}

// Returns (status check):
{
  status: "succeeded",
  output: "https://replicate.delivery/...wav"
}
```

### Frontend

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

```
src/
‚îú‚îÄ‚îÄ pages/workspace/
‚îÇ   ‚îî‚îÄ‚îÄ Studio.tsx                 # Main page (tabs)
‚îú‚îÄ‚îÄ components/studio/
‚îÇ   ‚îú‚îÄ‚îÄ MinimaxGenerator.tsx       # MiniMax form
‚îÇ   ‚îî‚îÄ‚îÄ AudioUpscaler.tsx          # AudioSR form
‚îú‚îÄ‚îÄ components/prompt-dj/
‚îÇ   ‚îî‚îÄ‚îÄ PromptDJ.tsx               # Prompt DJ UI
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useMinimaxGeneration.ts    # MiniMax hook
‚îÇ   ‚îî‚îÄ‚îÄ useAudioUpscale.ts         # AudioSR hook
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ PromptDJHelper.ts          # Prompt DJ logic
```

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### MiniMax Generator

```typescript
import { useMinimaxGeneration } from '@/hooks/useMinimaxGeneration';

const { mutate, isPending } = useMinimaxGeneration();

const handleGenerate = () => {
  mutate(
    {
      prompt: "blues, melancholic, heartbreak",
      lyrics: "[verse]\nSad lyrics here\n[chorus]\nMore sadness",
      sampleRate: 44100,
      bitrate: 256000,
      audioFormat: 'mp3'
    },
    {
      onSuccess: (data) => {
        console.log('Generated:', data.audioUrl);
      }
    }
  );
};
```

### Audio Upscaler

```typescript
import { useAudioUpscale, useAudioUpscaleStatus } from '@/hooks/useAudioUpscale';

const { mutate: upscale } = useAudioUpscale();
const [predictionId, setPredictionId] = useState<string | null>(null);

// Start upscaling
upscale(
  {
    inputFileUrl: 'https://example.com/audio.mp3',
    truncatedBatches: true,
    ddimSteps: 50,
    guidanceScale: 3.5
  },
  {
    onSuccess: (data) => setPredictionId(data.predictionId)
  }
);

// Poll status
const { data: status } = useAudioUpscaleStatus(predictionId, !!predictionId);

useEffect(() => {
  if (status?.status === 'succeeded') {
    console.log('Upscaled:', status.output);
  }
}, [status]);
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Required:**
- `REPLICATE_API_KEY` ‚Äî Replicate API –∫–ª—é—á (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
- `GOOGLE_AI_API_KEY` ‚Äî –î–ª—è Prompt DJ (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

### –ù–∞–≤–∏–≥–∞—Ü–∏—è

–°—Ç—Ä–∞–Ω–∏—Ü–∞ Studio –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
- **Path:** `/workspace/studio`
- **Icon:** `Headphones` (—É–∂–µ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
- **Tab Index:** –£–∂–µ –∞–∫—Ç–∏–≤–µ–Ω –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏

---

## üêõ Troubleshooting

### MiniMax Generator

**–û—à–∏–±–∫–∞: "Prompt must be 10-300 characters"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–º–ø—Ç –Ω–µ –ø—É—Å—Ç–æ–π

**–û—à–∏–±–∫–∞: "Lyrics must be 10-600 characters"**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
- –ú–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤, –º–∞–∫—Å–∏–º—É–º 600

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `REPLICATE_API_KEY` –≤ Supabase secrets
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Replicate API –¥–æ—Å—Ç—É–ø–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

### Audio Upscaler

**–°—Ç–∞—Ç—É—Å –∑–∞—Å—Ç—Ä—è–ª –Ω–∞ "processing":**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 2-5 –º–∏–Ω—É—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `truncatedBatches: true`

**–û—à–∏–±–∫–∞ "prediction failed":**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (MP3/WAV/M4A)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ edge function

### Prompt DJ

–°–º. `docs/PROMPT_DJ_GUIDE.md`

---

## üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### MiniMax Music-1.5

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–∏–º–∏—Ç |
|----------|-------|
| –ú–∞–∫—Å. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 240 —Å–µ–∫—É–Ω–¥ (4 –º–∏–Ω—É—Ç—ã) |
| –ú–∞–∫—Å. lyrics | 600 —Å–∏–º–≤–æ–ª–æ–≤ |
| Reference audio | 60 MB, 5-30 —Å–µ–∫—É–Ω–¥ |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏ | English, Chinese |

### AudioSR

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–∏–º–∏—Ç |
|----------|-------|
| –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç Replicate |
| Truncated batches | 5.12 —Å–µ–∫—É–Ω–¥ –Ω–∞ –±–∞—Ç—á |
| Output format | WAV 48kHz |

### Prompt DJ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –õ–∏–º–∏—Ç |
|----------|-------|
| –ú–∞–∫—Å. –ø—Ä–æ–º–ø—Ç–æ–≤ | 16 |
| –í–µ—Å–∞ | 0.0 - 1.0 |
| WebSocket timeout | 30 —Å–µ–∫—É–Ω–¥ keepalive |

---

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è:

1. **MiniMax:**
   - Upload local reference audio
   - Batch generation
   - Save to Library integration

2. **AudioSR:**
   - Batch upscaling
   - Queue management
   - Compare before/after

3. **Studio:**
   - Workflow automation (MiniMax ‚Üí AudioSR)
   - Preset management
   - Export to projects

4. **Integration:**
   - Save generated tracks to Library
   - Apply personas/styles
   - Share to projects

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-11-02  
**–°—Ç–∞—Ç—É—Å:** Production Ready
