# Чек-лист миграции и отката

Этот чек-лист должен использоваться для каждого инкремента из `CHANGE_PLAN_RFC.md`.

## Фаза 1: Подготовка к миграции

-   [ ] **Коммуникация:** Команда уведомлена о предстоящих изменениях.
-   [ ] **Feature Flag:** Изменение обернуто в feature flag (если применимо).
-   [ ] **Бэкап:** Создан бэкап базы данных (для изменений в БД).
-   [ ] **Тестирование:** Все тесты (unit, integration, e2e) успешно пройдены в staging-окружении.
-   [ ] **План отката:** План отката утвержден и понятен команде.

## Фаза 2: Процесс миграции

-   [ ] **Развертывание:** Изменения развернуты в production.
-   [ ] **Мониторинг:** Наблюдение за логами и метриками (Sentry, Supabase logs) на предмет аномалий.
-   [ ] **Валидация:** Проверка работоспособности затронутой функциональности в production.

## Фаза 3: Откат (если необходимо)

### Общий план отката

1.  **Активация rollback-процесса:** Уведомить команду о начале отката.
2.  **Откат через Git:** `git revert` коммита с изменениями.
3.  **Переразвертывание:** Развернуть предыдущую стабильную версию.
4.  **Восстановление БД:** Восстановить БД из бэкапа (если затронута схема).
5.  **Анализ причин:** Провести post-mortem для выяснения причин сбоя.

### Специфичные планы отката

| Изменение | План отката |
| :--- | :--- |
| **Обновление зависимостей** | `git checkout` предыдущей версии `package-lock.json` и `npm install`. |
| **Интеграция Lighthouse в CI** | Отключить шаг Lighthouse в `ci.yml` через `feature flag` или закомментировать. |
| **Изменения в RLS** | Применить SQL-скрипт, возвращающий предыдущие политики RLS. |
