# –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ê—É–¥–∏—Ç –ü—Ä–æ–µ–∫—Ç–∞ Albert3 Muse Synth Studio

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 2025-11-19
**–í–µ—Ä—Å–∏—è –∞—É–¥–∏—Ç–∞:** 2.0 (–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)
**–ê—É–¥–∏—Ç–æ—Ä:** Claude Code AI Assistant
**–û—Ö–≤–∞—Ç:** –ö–æ–¥–æ–≤–∞—è –±–∞–∑–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞, UI/UX, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìä Executive Summary

–ü—Ä–æ–µ–∫—Ç Albert3 Muse Synth Studio –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏ —Å –º–æ—â–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –∏ –ø–µ—Ä–µ–¥–æ–≤—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º —Å—Ç–µ–∫–æ–º. –û–¥–Ω–∞–∫–æ –∞–Ω–∞–ª–∏–∑ –≤—ã—è–≤–∏–ª **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Å–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —É—Å–ª–æ–∂–Ω–µ–Ω–∏—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∏—Å–∫—É —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏.

### –ö–ª—é—á–µ–≤—ã–µ –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (TS/TSX)** | ~27,603 | üü° –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ–µ–∫—Ç |
| **React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | 120+ | üü¢ –•–æ—Ä–æ—à–æ |
| **Custom hooks** | 130+ | üî¥ –ò–∑–±—ã—Ç–æ—á–Ω–æ |
| **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | 68 —Ñ–∞–π–ª–æ–≤ | üî¥ –ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ |
| **–§–∞–π–ª–æ–≤ –≤ features/tracks** | 68 | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏–∏ |
| **Largest file** | dawStore.ts (1,158 —Å—Ç—Ä–æ–∫) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| **God Class** | api.service.ts (563 —Å—Ç—Ä–æ–∫–∏) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| **Bundle size** | –ù–µ –∏–∑–º–µ—Ä–µ–Ω | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∞–Ω–∞–ª–∏–∑–∞ |

### –û–±—â–∞—è –û—Ü–µ–Ω–∫–∞: üü° **6.5/10**

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ (React 18, TypeScript, Vite)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TanStack Query –¥–ª—è server state
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (CLAUDE.md)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ best practices (React Query, Zustand)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª–∞–±–æ—Å—Ç–∏:**
- üî¥ –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ (God Class, God Store)
- üî¥ Monkey-patching —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
- üî¥ –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ö—É–∫–∏ (470+ —Å—Ç—Ä–æ–∫)
- üî¥ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏
- üî¥ –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏

---

## üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

#### 1.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `src/features/tracks/`

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞—Ä—É—à–µ–Ω–∏–µ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏ –∏ Domain-Driven Design

**–ù–∞—Ö–æ–¥–∫–∏:**
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç **68 —Ñ–∞–π–ª–æ–≤**, –º–Ω–æ–≥–∏–µ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ –¥–æ–º–µ–Ω—É "tracks"
- –°–º–µ—à–µ–Ω–∏–µ concerns: UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, API –ª–æ–≥–∏–∫–∞, —Ö—É–∫–∏, —É—Ç–∏–ª–∏—Ç—ã
- –ù–µ–æ—á–µ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
src/features/tracks/
‚îú‚îÄ‚îÄ api/                    # ‚úÖ –•–æ—Ä–æ—à–æ - domain-specific API
‚îú‚îÄ‚îÄ components/             # ‚ö†Ô∏è –°–º–µ—à–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ card/              # Track card components
‚îÇ   ‚îú‚îÄ‚îÄ shared/            # –û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ src/components)
‚îÇ   ‚îî‚îÄ‚îÄ TrackCard.tsx      # –î—É–±–ª–∏–∫–∞—Ç—ã —Å ui/TrackCard.tsx
‚îú‚îÄ‚îÄ hooks/                  # ‚úÖ Domain-specific hooks (7 —Ñ–∞–π–ª–æ–≤)
‚îú‚îÄ‚îÄ ui/                     # ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å components/
‚îÇ   ‚îú‚îÄ‚îÄ cards/             # 12 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö Card –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ tabs/              # Tab-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ DetailPanel*.tsx   # 5 –≤–µ—Ä—Å–∏–π DetailPanel
‚îî‚îÄ‚îÄ index.ts
```

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏:**
- `components/TrackCard.tsx` vs `ui/TrackCard.tsx` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
- 5 –≤–µ—Ä—Å–∏–π DetailPanel: `DetailPanel.tsx`, `DetailPanelMobile.tsx`, `DetailPanelMobileV2.tsx`, `MinimalDetailPanel.tsx`, `ModernDetailPanel.tsx`
- 12 —Ä–∞–∑–ª–∏—á–Ω—ã—Ö Card-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ `ui/cards/`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
   ```
   src/features/tracks/
   ‚îú‚îÄ‚îÄ api/              # Track-specific API calls
   ‚îú‚îÄ‚îÄ hooks/            # Track-specific hooks
   ‚îú‚îÄ‚îÄ components/       # –¢–û–õ–¨–ö–û track domain components
   ‚îú‚îÄ‚îÄ types/            # Track domain types
   ‚îî‚îÄ‚îÄ utils/            # Track utilities
   ```

2. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
   - `shared/*` ‚Üí `src/components/shared/`
   - –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ DetailPanel ‚Üí —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ –æ–¥–∏–Ω –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

3. **–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã:**
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å `components/` –∏ `ui/` –≤ –æ–¥–Ω—É –ø–∞–ø–∫—É
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Compound Components –¥–ª—è Card –≤–º–µ—Å—Ç–æ 12 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (2-3 –¥–Ω—è)
**–í–ª–∏—è–Ω–∏–µ:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞, DX, –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

#### 1.2. –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å Custom Hooks

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ü—Ä–æ–±–ª–µ–º–∞:** 130 custom hooks —Å–æ–∑–¥–∞—é—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É

**–ù–∞—Ö–æ–¥–∫–∏:**
- `src/hooks/`: **130 —Ñ–∞–π–ª–æ–≤**
- `src/features/tracks/hooks/`: 7 —Ñ–∞–π–ª–æ–≤
- –ú–Ω–æ–≥–∏–µ —Ö—É–∫–∏ —è–≤–ª—è—é—Ç—Å—è —Ç–æ–Ω–∫–∏–º–∏ –æ–±–µ—Ä—Ç–∫–∞–º–∏ –Ω–∞–¥ React Query –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —É—Ç–∏–ª–∏—Ç–∞–º–∏

**–ü—Ä–∏–º–µ—Ä—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ö—É–∫–æ–≤:**
```typescript
// useBreakpoints.ts - –ø—Ä–æ—Å—Ç–∞—è —É—Ç–∏–ª–∏—Ç–∞, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—É–∫–∞
// useCardActions.ts - –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ã—á–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π
// use-mobile.tsx - –¥—É–±–ª–∏—Ä—É–µ—Ç useBreakpoints
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–ê—É–¥–∏—Ç —Ö—É–∫–æ–≤:** –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 130 —Ö—É–∫–æ–≤:
   - Stateful hooks (—Ç—Ä–µ–±—É—é—Ç useState/useEffect) ‚Üí –æ—Å—Ç–∞–≤–∏—Ç—å
   - Pure functions ‚Üí –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ `src/utils/`
   - Thin wrappers ‚Üí —É–¥–∞–ª–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é

2. **–°–æ–∑–¥–∞—Ç—å guidelines:**
   - –ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ö—É–∫ vs —É—Ç–∏–ª–∏—Ç—É
   - Naming conventions
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ (max 100 —Å—Ç—Ä–æ–∫ –¥–ª—è —Ö—É–∫–∞)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (3-5 –¥–Ω–µ–π)
**–í–ª–∏—è–Ω–∏–µ:** Code clarity, Bundle size, Maintenance

---

### 2. Anti-Patterns –∏ Code Smells

#### 2.1. God Class: `api.service.ts`

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/services/api.service.ts:133-562`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏, –Ω–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle

**–ú–µ—Ç—Ä–∏–∫–∏:**
- **–†–∞–∑–º–µ—Ä:** 563 —Å—Ç—Ä–æ–∫–∏
- **–ú–µ—Ç–æ–¥–æ–≤:** 13 –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤
- **Responsibilities:** Tracks, Lyrics, Prompts, Balance, Stems

**–ö–æ–¥ (—Ñ—Ä–∞–≥–º–µ–Ω—Ç):**
```typescript:src/services/api.service.ts
export class ApiService {
  // Track operations
  static async getUserTracks(userId: string): Promise<Track[]> { ... }
  static async getTrackById(trackId: string): Promise<Track | null> { ... }
  static async deleteTrack(trackId: string): Promise<void> { ... }

  // Lyrics operations
  static async generateLyrics(request: GenerateLyricsRequest): Promise<...> { ... }

  // Prompt operations
  static async improvePrompt(request: ImprovePromptRequest): Promise<...> { ... }

  // Balance operations
  static async getProviderBalance(provider: 'suno' | 'replicate'): Promise<...> { ... }

  // Stem operations
  static async syncStemJob(params: {...}): Promise<boolean> { ... }
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ SRP:** –û–¥–∏–Ω –∫–ª–∞—Å—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ 5+ –¥–æ–º–µ–Ω–æ–≤
2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã —Å–ª–æ–∂–Ω–æ –º–æ–∫–∞—Ç—å
3. **Tight coupling:** –í—Å–µ —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
4. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏:** –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –¥–æ–º–µ–Ω–µ –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã**
```typescript
// src/services/tracks/track.service.ts
export class TrackService {
  static async getUserTracks(userId: string): Promise<Track[]> { ... }
  static async getById(trackId: string): Promise<Track | null> { ... }
  static async delete(trackId: string): Promise<void> { ... }
  static async incrementPlayCount(trackId: string): Promise<void> { ... }
}

// src/services/lyrics/lyrics.service.ts
export class LyricsService {
  static async generate(request: GenerateLyricsRequest): Promise<...> { ... }
}

// src/services/prompts/prompt.service.ts
export class PromptService {
  static async improve(request: ImprovePromptRequest): Promise<...> { ... }
}

// src/services/balance/balance.service.ts
export class BalanceService {
  private static inFlightBalance: Map<string, Promise<...>> = new Map();
  private static cache: Map<string, ProviderBalanceResponse> = new Map();

  static async getProviderBalance(provider: 'suno' | 'replicate'): Promise<...> { ... }
}

// src/services/stems/stem.service.ts
export class StemService {
  static async syncJob(params: {...}): Promise<boolean> { ... }
}
```

**–®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã**
```typescript
// Before
import { ApiService } from '@/services/api.service';
await ApiService.getUserTracks(userId);

// After
import { TrackService } from '@/services/tracks/track.service';
await TrackService.getUserTracks(userId);
```

**–®–∞–≥ 3: Deprecate ApiService**
```typescript
// src/services/api.service.ts
/**
 * @deprecated Use domain-specific services instead:
 * - TrackService for track operations
 * - LyricsService for lyrics
 * - PromptService for prompts
 * - BalanceService for balance
 * - StemService for stems
 */
export class ApiService {
  static async getUserTracks(userId: string): Promise<Track[]> {
    console.warn('ApiService.getUserTracks is deprecated. Use TrackService.getUserTracks');
    return TrackService.getUserTracks(userId);
  }
  // ... delegate to new services
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (2-3 –¥–Ω—è)
**–í–ª–∏—è–Ω–∏–µ:** Maintainability, Testability, Scalability

---

#### 2.2. God Store: `dawStore.ts`

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/stores/dawStore.ts:1-1158`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π Zustand store —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º DAW —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

**–ú–µ—Ç—Ä–∏–∫–∏:**
- **–†–∞–∑–º–µ—Ä:** 1,158 —Å—Ç—Ä–æ–∫ (–æ–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ)
- **State fields:** 8 (project, timeline, selection, clipboard, isPlaying, isRecording, history, toolMode)
- **Actions:** 40+ –º–µ—Ç–æ–¥–æ–≤
- **Complexity:** –í—ã—Å–æ–∫–∞—è (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞–º–∏, –∫–ª–∏–ø–∞–º–∏, —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏, –º–∞—Ä–∫–µ—Ä–∞–º–∏, undo/redo)

**–ö–æ–¥ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞):**
```typescript:src/stores/dawStore.ts
export const useDAWStore = create<DAWState>()(
  devtools(
    persist(
      (set, get) => ({
        // STATE (8 fields)
        project: DAWProject | null,
        timeline: TimelineState,
        selection: SelectionState,
        clipboard: ClipboardState,
        isPlaying: boolean,
        isRecording: boolean,
        history: DAWProject[],
        historyIndex: number,
        toolMode: 'select' | 'cut' | 'draw' | 'erase',

        // PROJECT ACTIONS (5 methods)
        createProject, loadProject, saveProject, updateProjectName, updateBPM,

        // TRACK ACTIONS (5 methods)
        addTrack, removeTrack, updateTrack, duplicateTrack, loadStemsAsMultitrack,

        // CLIP ACTIONS (5 methods)
        addClip, removeClip, updateClip, splitClip, duplicateClip,

        // TIMELINE ACTIONS (9 methods)
        play, pause, stop, seekTo, setLoop, toggleLoop, setZoom, setScroll, ...

        // SELECTION ACTIONS (4 methods)
        selectClip, selectTrack, selectRegion, clearSelection,

        // CLIPBOARD ACTIONS (4 methods)
        cutSelected, copySelected, paste, deleteSelected,

        // MARKER/REGION ACTIONS (4 methods)
        addMarker, removeMarker, addRegion, removeRegion,

        // EFFECT ACTIONS (4 methods)
        addEffect, removeEffect, updateEffect, toggleEffect,

        // UNDO/REDO (3 methods)
        undo, redo, pushHistory,

        // UTILITY (3 methods)
        setToolMode, snapTimeToGrid, getTrackByClipId,
      })
    )
  )
);
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –õ—é–±–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ò—Å—Ç–æ—Ä–∏—è (50 —Å–Ω–∞–ø—à–æ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞) –∑–∞–Ω–∏–º–∞–µ—Ç –ø–∞–º—è—Ç—å
   - –û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –º–∞—Å—Å–∏–≤–∞–º–∏ —Ç—Ä–µ–∫–æ–≤/–∫–ª–∏–ø–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏

2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏
   - 40+ –º–µ—Ç–æ–¥–æ–≤ —Ç—Ä–µ–±—É—é—Ç —Å–æ—Ç–µ–Ω —Ç–µ—Å—Ç–æ–≤
   - **–ö–†–ò–¢–ò–ß–ù–û:** –ù–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –¥–ª—è dawStore.ts!

3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:**
   - 1158 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
   - –°–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É actions
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π —á–∞—Å—Ç–∏ –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å –¥—Ä—É–≥–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**–†–µ—à–µ–Ω–∏–µ 1: Slice Pattern (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

–†–∞–∑–±–∏—Ç—å –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–ª–∞–π—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Zustand slices:

```typescript
// src/stores/daw/projectSlice.ts
export interface ProjectSlice {
  project: DAWProject | null;
  createProject: (name: string) => void;
  loadProject: (project: DAWProject) => void;
  saveProject: () => Promise<void>;
  updateProjectName: (name: string) => void;
  updateBPM: (bpm: number) => void;
}

export const createProjectSlice: StateCreator<
  ProjectSlice & TimelineSlice & TrackSlice & ClipSlice,
  [],
  [],
  ProjectSlice
> = (set, get) => ({
  project: null,
  createProject: (name) => { ... },
  loadProject: (project) => { ... },
  saveProject: async () => { ... },
  updateProjectName: (name) => { ... },
  updateBPM: (bpm) => { ... },
});

// src/stores/daw/timelineSlice.ts
export const createTimelineSlice: StateCreator<...> = (set, get) => ({
  timeline: createDefaultTimeline(),
  play: () => set({ isPlaying: true }),
  pause: () => set({ isPlaying: false }),
  stop: () => { ... },
  seekTo: (time) => { ... },
  // ...
});

// src/stores/daw/trackSlice.ts
export const createTrackSlice: StateCreator<...> = (set, get) => ({
  addTrack: (type, name) => { ... },
  removeTrack: (trackId) => { ... },
  updateTrack: (trackId, updates) => { ... },
  // ...
});

// src/stores/daw/clipSlice.ts
export const createClipSlice: StateCreator<...> = (set, get) => ({
  addClip: (trackId, clipData) => { ... },
  removeClip: (clipId) => { ... },
  updateClip: (clipId, updates) => { ... },
  // ...
});

// src/stores/daw/historySlice.ts
export const createHistorySlice: StateCreator<...> = (set, get) => ({
  history: [],
  historyIndex: -1,
  undo: () => { ... },
  redo: () => { ... },
  pushHistory: () => { ... },
});

// src/stores/dawStore.ts (–≥–ª–∞–≤–Ω—ã–π store - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å–ª–∞–π—Å—ã)
export const useDAWStore = create<DAWState>()(
  devtools(
    persist(
      (...a) => ({
        ...createProjectSlice(...a),
        ...createTimelineSlice(...a),
        ...createTrackSlice(...a),
        ...createClipSlice(...a),
        ...createHistorySlice(...a),
        ...createSelectionSlice(...a),
        ...createClipboardSlice(...a),
      }),
      { name: 'daw-storage' }
    )
  )
);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ (–ª–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)
- ‚úÖ –§–∞–π–ª—ã –ø–æ ~100-200 —Å—Ç—Ä–æ–∫ (—á–∏—Ç–∞–µ–º–æ—Å—Ç—å)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–∞–π—Å—ã
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–µ–Ω—å—à–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö)

**–†–µ—à–µ–Ω–∏–µ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤**

–ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤:

```typescript
// src/stores/daw/selectors.ts
export const useDAWProject = () => useDAWStore((state) => state.project);
export const useDAWTimeline = () => useDAWStore((state) => state.timeline);
export const useDAWTracks = () => useDAWStore((state) => state.project?.tracks || []);
export const useDAWIsPlaying = () => useDAWStore((state) => state.isPlaying);

// –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
export const useDAWControls = () => useDAWStore(
  (state) => ({
    play: state.play,
    pause: state.pause,
    stop: state.stop,
    seekTo: state.seekTo,
  }),
  shallow // –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤
);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (5-7 –¥–Ω–µ–π)
**–í–ª–∏—è–Ω–∏–µ:** Performance, Maintainability, Testability

**–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. –ù–µ–¥–µ–ª—è 1: –°–æ–∑–¥–∞—Ç—å slice —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
2. –ù–µ–¥–µ–ª—è 2: –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. –ù–µ–¥–µ–ª—è 3: Performance —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

#### 2.3. Monkey Patching: Supabase Client

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/integrations/supabase/client.ts:72-141`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `supabase.functions.invoke` —á–µ—Ä–µ–∑ monkey-patching

**–ö–æ–¥:**
```typescript:src/integrations/supabase/client.ts
export const supabase = createSupabaseClient();

const originalInvoke = supabase.functions.invoke.bind(supabase.functions);

// ‚ùå MONKEY PATCHING - —Ö—Ä—É–ø–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ
supabase.functions.invoke = (async (functionName, options = {}) => {
  const normalizedHeaders = normalizeHeaders(options.headers);
  const headersWithAuth = await ensureAuthHeader(normalizedHeaders);

  const headers =
    typeof window === "undefined"
      ? { ...headersWithAuth, "x-app-environment": appEnv.appEnv }
      : headersWithAuth;

  // Hardcoded logging –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
  try {
    if (typeof window !== "undefined" && (functionName.startsWith("get-balance") || functionName === "separate-stems")) {
      const method = (options as { method?: string }).method ?? "POST";
      const hasAuth = Object.keys(headers).some(
        (key) => key.toLowerCase() === "authorization"
      );
      import('@/utils/logger').then(({ logger }) => {
        logger.debug(`Function invocation: ${functionName}`, undefined, { method, hasAuth });
      });
    }
  } catch (_) {}

  return originalInvoke(functionName, {
    ...options,
    headers,
  });
}) as typeof supabase.functions.invoke;
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–•—Ä—É–ø–∫–æ—Å—Ç—å:**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `@supabase/supabase-js` –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ
   - TypeScript –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
   - –ù–∞—Ä—É—à–∞–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø Open/Closed

2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –°–ª–æ–∂–Ω–æ –º–æ–∫–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—Ç—á –≤ unit-—Ç–µ—Å—Ç–∞—Ö
   - –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è

3. **Hardcoded –ª–æ–≥–∏–∫–∞:**
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è `get-balance` –∏ `separate-stems`
   - –ù–∞—Ä—É—à–µ–Ω–∏–µ DRY (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –µ–¥–∏–Ω—ã–º)

4. **Performance:**
   - Dynamic import –≤ hot path (`import('@/utils/logger')`)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `typeof window` –∏ `functionName.startsWith` –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**–†–µ—à–µ–Ω–∏–µ 1: Wrapper Class (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```typescript
// src/integrations/supabase/client.ts
export const supabase = createSupabaseClient();

// src/integrations/supabase/functions.ts
import { supabase } from './client';
import { logger } from '@/utils/logger';
import { appEnv } from '@/config/env';

interface InvokeOptions {
  headers?: HeadersInit;
  body?: Record<string, unknown>;
  method?: string;
}

export class SupabaseFunctions {
  /**
   * Invokes a Supabase Edge Function with automatic auth header injection
   */
  static async invoke<T = unknown>(
    functionName: string,
    options: InvokeOptions = {}
  ): Promise<{ data: T | null; error: Error | null }> {
    const normalizedHeaders = this.normalizeHeaders(options.headers);
    const headersWithAuth = await this.ensureAuthHeader(normalizedHeaders);

    const headers = typeof window === "undefined"
      ? { ...headersWithAuth, "x-app-environment": appEnv.appEnv }
      : headersWithAuth;

    // Centralized logging
    this.logInvocation(functionName, options.method ?? 'POST', headers);

    return supabase.functions.invoke<T>(functionName, {
      ...options,
      headers,
    });
  }

  private static normalizeHeaders(init?: HeadersInit): Record<string, string> {
    if (typeof Headers !== "undefined" && init instanceof Headers) {
      const headers = new Headers(init);
      const result: Record<string, string> = {};
      headers.forEach((value, key) => {
        result[key] = value;
      });
      return result;
    }

    if (!init) return {};
    if (Array.isArray(init)) {
      const result: Record<string, string> = {};
      init.forEach(([key, value]) => {
        result[key] = value;
      });
      return result;
    }

    return init as Record<string, string>;
  }

  private static async ensureAuthHeader(
    headers: Record<string, string>
  ): Promise<Record<string, string>> {
    if (typeof window === "undefined") return headers;

    const hasAuthHeader = Object.keys(headers).some(
      (key) => key.toLowerCase() === "authorization"
    );

    if (hasAuthHeader) return headers;

    try {
      const { data: { session } } = await supabase.auth.getSession();

      if (session?.access_token) {
        return {
          ...headers,
          Authorization: `Bearer ${session.access_token}`,
        };
      }
    } catch (error) {
      logger.warn('Failed to attach auth header', undefined, { error });
    }

    return headers;
  }

  private static logInvocation(
    functionName: string,
    method: string,
    headers: Record<string, string>
  ): void {
    if (typeof window === "undefined") return;

    const hasAuth = Object.keys(headers).some(
      (key) => key.toLowerCase() === "authorization"
    );

    logger.debug(`Edge Function: ${functionName}`, undefined, {
      method,
      hasAuth,
      timestamp: new Date().toISOString(),
    });
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```typescript
// Before (monkey-patched)
import { supabase } from '@/integrations/supabase/client';
const { data, error } = await supabase.functions.invoke('get-balance', { body: { provider } });

// After (wrapper)
import { SupabaseFunctions } from '@/integrations/supabase/functions';
const { data, error } = await SupabaseFunctions.invoke('get-balance', { body: { provider } });

// Or create a shorter alias
export const functions = SupabaseFunctions;
const { data, error } = await functions.invoke('get-balance', { body: { provider } });
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ—Ç monkey-patching (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö)
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–º–æ–∂–Ω–æ –º–æ–∫–∞—Ç—å SupabaseFunctions)
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ TypeScript-friendly
- ‚úÖ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å retry logic, rate limiting –∏ —Ç.–¥.

**–†–µ—à–µ–Ω–∏–µ 2: HTTP Interceptor (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**

```typescript
// src/integrations/supabase/interceptor.ts
import { createClient, type SupabaseClient } from '@supabase/supabase-js';

export const createInterceptedClient = (
  url: string,
  key: string,
  options: any
): SupabaseClient => {
  const client = createClient(url, key, {
    ...options,
    global: {
      ...options.global,
      fetch: async (input: RequestInfo | URL, init?: RequestInit) => {
        // Inject auth headers before fetch
        const session = await client.auth.getSession();
        const headers = new Headers(init?.headers);

        if (session.data.session?.access_token) {
          headers.set('Authorization', `Bearer ${session.data.session.access_token}`);
        }

        return fetch(input, {
          ...init,
          headers,
        });
      },
    },
  });

  return client;
};

export const supabase = createInterceptedClient(
  appEnv.supabaseUrl,
  appEnv.supabaseAnonKey,
  clientOptions
);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (1-2 –¥–Ω—è)
**–í–ª–∏—è–Ω–∏–µ:** Stability, Maintainability, Testability

---

#### 2.4. –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π Hook: `useGenerateMusic`

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/hooks/useGenerateMusic.ts:1-471`

**–ü—Ä–æ–±–ª–µ–º–∞:** Hook –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–¥–∞—á, –Ω–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility Principle

**–ú–µ—Ç—Ä–∏–∫–∏:**
- **–†–∞–∑–º–µ—Ä:** 471 —Å—Ç—Ä–æ–∫–∞ (–æ–¥–∏–Ω –∏–∑ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö —Ö—É–∫–æ–≤)
- **Responsibilities:** 7 (validation, sanitization, rate limiting, API calls, realtime subscriptions, polling, UI notifications)
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** 10+ –∏–º–ø–æ—Ä—Ç–æ–≤
- **Complexity:** –í—ã—Å–æ–∫–∞—è (state machine —Å 3 —Ä–µ–∂–∏–º–∞–º–∏: idle ‚Üí generating ‚Üí completed/failed)

**–ö–æ–¥ (–∫–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏):**
```typescript:src/hooks/useGenerateMusic.ts
export const useGenerateMusic = ({ provider = 'suno', onSuccess, toast }: UseGenerateMusicOptions) => {
  const [isGenerating, setIsGenerating] = useState(false);

  // Responsibilities:
  // 1. State management (useState, useRef)
  // 2. Cleanup logic (useEffect, cleanup function)
  // 3. Polling fallback (startPolling)
  // 4. Realtime subscriptions (setupSubscription)
  // 5. Input sanitization (sanitizePrompt, sanitizeLyrics, sanitizeTitle)
  // 6. Rate limiting (rateLimiter.check)
  // 7. Validation (prompt validation)
  // 8. API calls (GenerationService.generate)
  // 9. Error handling (try/catch, Sentry)
  // 10. UI notifications (toast messages)
  // 11. Sentry tracking (addBreadcrumb, trackGenerationEvent)

  const generate = useCallback(async (options: GenerationRequest): Promise<boolean> => {
    // ‚úÖ Sanitize inputs (responsibility #5)
    const sanitizedOptions = {
      prompt: sanitizePrompt(options.prompt || ''),
      title: options.title ? sanitizeTitle(options.title) : undefined,
      lyrics: options.lyrics ? sanitizeLyrics(options.lyrics) : undefined,
    };

    // ‚úÖ Logging (responsibility #11)
    logger.info('Generation request received', 'useGenerateMusic', {...});
    addBreadcrumb('Music generation started', 'generation', {...});
    Sentry.setTag('generation.provider', effectiveProvider);

    // ‚úÖ Validation (responsibility #7)
    if (!effectivePrompt) {
      toast({ title: '–û—à–∏–±–∫–∞', description: '–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ', variant: 'destructive' });
      return false;
    }

    // ‚úÖ Rate limiting (responsibility #6)
    const rateLimit = rateLimiter.check(user.id, RATE_LIMIT_CONFIGS.GENERATION);
    if (!rateLimit.allowed) {
      toast({ title: '–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç', ... });
      return false;
    }

    // ‚úÖ API call (responsibility #8)
    const result = await GenerationService.generate({...});

    // ‚úÖ Error handling (responsibility #9)
    if (!result.success) {
      toast({ title: '–û—à–∏–±–∫–∞', ... });
      return false;
    }

    // ‚úÖ UI notification (responsibility #10)
    toast({ title: 'üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å!', ... });

    // ‚úÖ Realtime subscription (responsibility #4)
    setupSubscription(result.trackId, isCachedResult);

    return true;
  }, [isGenerating, provider, cleanup, setupSubscription, toastRef, onSuccessRef]);

  return { generate, isGenerating, cleanup };
};
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ SRP:**
   - Hook —Å–º–µ—à–∏–≤–∞–µ—Ç UI –ª–æ–≥–∏–∫—É (toast), –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (validation), –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (subscriptions)
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç toast

2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –î–ª—è —Ç–µ—Å—Ç–∞ –Ω—É–∂–Ω–æ –º–æ–∫–∞—Ç—å: toast, logger, Sentry, supabase, GenerationService, rateLimiter
   - 471 —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–æ—Ç–µ–Ω —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤

3. **Tight coupling:**
   - Hook –∑–Ω–∞–µ—Ç –æ UI (toast messages)
   - Hook –∑–Ω–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö (RealtimeSubscriptionManager)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**–†–µ—à–µ–Ω–∏–µ 1: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Concerns (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```typescript
// src/hooks/generation/useGenerationState.ts
// Pure state management (no UI, no side effects)
export const useGenerationState = () => {
  const [isGenerating, setIsGenerating] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  return {
    isGenerating,
    error,
    setIsGenerating,
    setError,
  };
};

// src/hooks/generation/useGenerationValidation.ts
// Pure validation logic
export const useGenerationValidation = () => {
  const validate = useCallback((options: GenerationRequest) => {
    const errors: string[] = [];

    if (!options.prompt?.trim()) {
      errors.push('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º—É–∑—ã–∫–∏');
    }

    if (options.prompt && options.prompt.length > 1000) {
      errors.push('–ü—Ä–æ–º–ø—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (max 1000 —Å–∏–º–≤–æ–ª–æ–≤)');
    }

    return {
      isValid: errors.length === 0,
      errors,
    };
  }, []);

  return { validate };
};

// src/hooks/generation/useGenerationRateLimit.ts
// Rate limiting logic
export const useGenerationRateLimit = (userId: string | undefined) => {
  const check = useCallback(() => {
    if (!userId) return { allowed: false, reason: 'Unauthorized' };

    const rateLimit = rateLimiter.check(userId, RATE_LIMIT_CONFIGS.GENERATION);

    return {
      allowed: rateLimit.allowed,
      remaining: rateLimit.remaining,
      resetAt: rateLimit.resetAt,
      reason: rateLimit.allowed ? undefined : 'Rate limit exceeded',
    };
  }, [userId]);

  return { check };
};

// src/hooks/generation/useGenerationSubscription.ts
// Realtime subscription logic
export const useGenerationSubscription = () => {
  const unsubscribeRef = useRef<(() => void) | null>(null);

  const subscribe = useCallback((trackId: string, onUpdate: (track: TrackRow) => void) => {
    const unsubscribe = RealtimeSubscriptionManager.subscribeToTrack(
      trackId,
      (payload) => onUpdate(payload.new as TrackRow)
    );

    unsubscribeRef.current = unsubscribe;
    return unsubscribe;
  }, []);

  const cleanup = useCallback(() => {
    if (unsubscribeRef.current) {
      unsubscribeRef.current();
      unsubscribeRef.current = null;
    }
  }, []);

  useEffect(() => cleanup, [cleanup]);

  return { subscribe, cleanup };
};

// src/hooks/generation/useGenerateMusic.ts
// Main hook - orchestrates other hooks
export const useGenerateMusic = ({ provider = 'suno', onSuccess }: UseGenerateMusicOptions) => {
  const { isGenerating, setIsGenerating, error, setError } = useGenerationState();
  const { validate } = useGenerationValidation();
  const { data: { user } } = useUser();
  const { check: checkRateLimit } = useGenerationRateLimit(user?.id);
  const { subscribe, cleanup } = useGenerationSubscription();

  const generate = useCallback(async (options: GenerationRequest): Promise<GenerationResult> => {
    // 1. Validation
    const validation = validate(options);
    if (!validation.isValid) {
      return {
        success: false,
        errors: validation.errors,
      };
    }

    // 2. Rate limiting
    const rateLimit = checkRateLimit();
    if (!rateLimit.allowed) {
      return {
        success: false,
        errors: [rateLimit.reason!],
      };
    }

    // 3. Sanitization
    const sanitized = {
      ...options,
      prompt: sanitizePrompt(options.prompt),
      title: options.title ? sanitizeTitle(options.title) : undefined,
      lyrics: options.lyrics ? sanitizeLyrics(options.lyrics) : undefined,
    };

    setIsGenerating(true);

    try {
      // 4. API call
      const result = await GenerationService.generate(sanitized);

      if (!result.success) {
        setError(new Error(result.error));
        return result;
      }

      // 5. Setup subscription
      subscribe(result.trackId!, (track) => {
        if (track.status === 'completed') {
          onSuccess?.();
          cleanup();
        } else if (track.status === 'failed') {
          setError(new Error(track.error_message || 'Generation failed'));
          cleanup();
        }
      });

      return result;
    } catch (err) {
      const error = err as Error;
      setError(error);
      return {
        success: false,
        errors: [error.message],
      };
    } finally {
      setIsGenerating(false);
    }
  }, [validate, checkRateLimit, subscribe, cleanup, onSuccess]);

  return {
    generate,
    isGenerating,
    error,
    cleanup,
  };
};
```

**UI Layer (separate):**
```typescript
// src/components/generation/GenerationForm.tsx
import { useGenerateMusic } from '@/hooks/generation/useGenerateMusic';
import { useToast } from '@/hooks/use-toast';

export const GenerationForm = () => {
  const { toast } = useToast();
  const { generate, isGenerating, error } = useGenerateMusic({
    provider: 'suno',
    onSuccess: () => {
      toast({ title: '‚úÖ –¢—Ä–µ–∫ –≥–æ—Ç–æ–≤!', description: '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞' });
    },
  });

  const handleSubmit = async (data: FormData) => {
    const result = await generate(data);

    if (!result.success) {
      // UI logic here
      toast({
        title: '–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏',
        description: result.errors.join(', '),
        variant: 'destructive',
      });
    } else {
      // UI logic here
      toast({
        title: 'üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å!',
        description: '–í–∞—à —Ç—Ä–µ–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è...',
      });
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      {/* form fields */}
      <Button type="submit" disabled={isGenerating}>
        {isGenerating ? '–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è...' : '–°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫'}
      </Button>
      {error && <ErrorMessage error={error} />}
    </form>
  );
};
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Separation of Concerns (–∫–∞–∂–¥—ã–π —Ö—É–∫ = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏)
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å validation, rate limiting –æ—Ç–¥–µ–ª—å–Ω–æ)
- ‚úÖ –ú–µ–Ω—å—à–∏–µ —Ñ–∞–π–ª—ã (~50-100 —Å—Ç—Ä–æ–∫ –∫–∞–∂–¥—ã–π)
- ‚úÖ UI logic –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è (2-3 –¥–Ω—è)
**–í–ª–∏—è–Ω–∏–µ:** Testability, Reusability, Maintainability

---

### 3. UI/UX –∏ –î–∏–∑–∞–π–Ω-–°–∏—Å—Ç–µ–º–∞

#### 3.1. –ö–∞—Å—Ç–æ–º–Ω—ã–µ Button Variants

**–°—Ç–∞—Ç—É—Å:** üü° **–¢—Ä–µ–±—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/components/ui/button.tsx:21-23`

**–ù–∞—Ö–æ–¥–∫–∏:**

–î–æ–±–∞–≤–ª–µ–Ω—ã 3 –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–Ω–æ–ø–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ —Ä–∞–º–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π shadcn/ui –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã:

```typescript:src/components/ui/button.tsx
const buttonVariants = cva("...", {
  variants: {
    variant: {
      // Standard shadcn variants
      default: "bg-primary text-primary-foreground hover:bg-primary/90",
      destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
      outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
      secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
      ghost: "hover:bg-accent hover:text-accent-foreground",
      link: "text-primary underline-offset-4 hover:underline",

      // ‚ö†Ô∏è Custom variants (undocumented)
      hero: "bg-gradient-to-r from-primary to-primary/80 text-primary-foreground hover:from-primary/90 hover:to-primary/70 shadow-lg",
      glass: "bg-background/20 backdrop-blur-md border border-border/50 hover:bg-background/30",
      glow: "bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg shadow-primary/50",
    },
  },
});
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
   - –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `hero` vs `default`?
   - –í —á—ë–º –æ—Ç–ª–∏—á–∏–µ `glow` –æ—Ç `default` (–∫—Ä–æ–º–µ shadow)?
   - –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

2. **–†–∏—Å–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥—ã, –Ω–µ –∑–Ω–∞—è –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö
   - –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ

3. **Accessibility:**
   - `glass` –≤–∞—Ä–∏–∞–Ω—Ç —Å `bg-background/20` –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–∏–∑–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ WCAG AA/AAA compliance

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**1. –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Storybook –∏–ª–∏ MDX)**

```tsx
// src/components/ui/__docs__/button.stories.tsx
import { Button } from '../button';

export default {
  title: 'UI/Button',
  component: Button,
};

export const Variants = () => (
  <div className="space-y-4">
    <div>
      <h3>Default</h3>
      <p>Standard primary action button</p>
      <Button variant="default">Click me</Button>
    </div>

    <div>
      <h3>Hero</h3>
      <p>Use for primary CTA on landing pages or hero sections</p>
      <Button variant="hero">Get Started</Button>
    </div>

    <div>
      <h3>Glass (Glassmorphism)</h3>
      <p>Use on image overlays or gradient backgrounds. Requires backdrop-blur support.</p>
      <p className="text-red-500">‚ö†Ô∏è Accessibility: Ensure sufficient color contrast</p>
      <div className="bg-gradient-to-r from-purple-500 to-pink-500 p-8">
        <Button variant="glass">Glass Button</Button>
      </div>
    </div>

    <div>
      <h3>Glow</h3>
      <p>Use for special actions that need extra attention (e.g., "Generate Music")</p>
      <Button variant="glow">Generate Track</Button>
    </div>
  </div>
);
```

**2. –°–æ–∑–¥–∞—Ç—å Design System Guidelines**

```markdown
# Button Variants Guide

## Standard Variants (shadcn/ui)

| Variant | Use Case | Example |
|---------|----------|---------|
| `default` | Primary actions | "Save", "Submit", "Create" |
| `destructive` | Dangerous actions | "Delete", "Remove" |
| `outline` | Secondary actions | "Cancel", "Back" |
| `secondary` | Tertiary actions | "Learn More" |
| `ghost` | Minimal emphasis | Icon buttons, nav items |
| `link` | Text-only buttons | "View details", "See more" |

## Custom Variants (Project-specific)

### Hero Button
- **Use Case:** Primary CTA on landing pages, hero sections
- **Visual:** Gradient background with shadow
- **Accessibility:** ‚úÖ WCAG AA compliant
- **Example:**
  ```tsx
  <Button variant="hero" size="lg">Start Creating Music</Button>
  ```

### Glass Button (Glassmorphism)
- **Use Case:** Overlays on images or gradients
- **Visual:** Semi-transparent with backdrop blur
- **Accessibility:** ‚ö†Ô∏è **Use only on high-contrast backgrounds**
- **Browser Support:** Requires `backdrop-filter` support
- **Example:**
  ```tsx
  <div className="relative">
    <img src="hero.jpg" />
    <div className="absolute inset-0 flex items-center justify-center">
      <Button variant="glass">Play Track</Button>
    </div>
  </div>
  ```

### Glow Button
- **Use Case:** Special actions requiring attention
- **Visual:** Primary color with glow shadow effect
- **Accessibility:** ‚úÖ WCAG AA compliant
- **Example:**
  ```tsx
  <Button variant="glow" size="lg">
    <Music className="mr-2" /> Generate Music
  </Button>
  ```

## Decision Tree

```
Is this a dangerous action (delete, remove)?
‚îú‚îÄ YES ‚Üí Use `destructive`
‚îî‚îÄ NO ‚Üí Is this the primary action on the page?
    ‚îú‚îÄ YES ‚Üí Is this a hero section or landing page?
    ‚îÇ   ‚îú‚îÄ YES ‚Üí Use `hero`
    ‚îÇ   ‚îî‚îÄ NO ‚Üí Does it need extra attention?
    ‚îÇ       ‚îú‚îÄ YES ‚Üí Use `glow`
    ‚îÇ       ‚îî‚îÄ NO ‚Üí Use `default`
    ‚îî‚îÄ NO ‚Üí Is this a secondary action?
        ‚îú‚îÄ YES ‚Üí Use `outline`
        ‚îî‚îÄ NO ‚Üí Is this a tertiary action?
            ‚îú‚îÄ YES ‚Üí Use `secondary` or `ghost`
            ‚îî‚îÄ NO ‚Üí Use `link` for text-only
```
```

**3. –ê—É–¥–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**

```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
grep -r 'variant="hero"' src/
grep -r 'variant="glass"' src/
grep -r 'variant="glow"' src/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å consistency
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2 (–°—Ä–µ–¥–Ω–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (1 –¥–µ–Ω—å)
**–í–ª–∏—è–Ω–∏–µ:** DX, Consistency, Onboarding

---

#### 3.2. Tailwind Configuration

**–°—Ç–∞—Ç—É—Å:** üü° **–ù–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ —Å–ª–æ–∂–Ω–æ**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `tailwind.config.ts:1-371`

**–ù–∞—Ö–æ–¥–∫–∏:**

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tailwind –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–∞—è (371 —Å—Ç—Ä–æ–∫–∞), —á—Ç–æ –º–æ–∂–µ—Ç —É—Å–ª–æ–∂–Ω–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É:

```typescript:tailwind.config.ts
const config: Config = {
  theme: {
    extend: {
      colors: {
        // 10+ color shades for primary
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
          50: "hsl(var(--color-primary-50))",
          100: "hsl(var(--color-primary-100))",
          // ... –¥–æ 950
        },
        // –ú–Ω–æ–∂–µ—Å—Ç–≤–æ accent colors
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
          purple: "hsl(var(--color-accent-purple))",
          blue: "hsl(var(--color-accent-blue))",
          pink: "hsl(var(--color-accent-pink))",
          green: "hsl(var(--color-accent-green))",
          orange: "hsl(var(--color-accent-orange))",
          red: "hsl(var(--color-accent-red))",
        },
        // ... –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ
      },

      // 100+ —Å—Ç—Ä–æ–∫ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö animations
      animation: {
        "fade-in": "fade-in 0.3s ease-in",
        "fade-out": "fade-out 0.3s ease-out",
        "slide-in-from-top": "slide-in-from-top 0.3s ease-out",
        // ... –¥–µ—Å—è—Ç–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–π
      },

      keyframes: {
        "fade-in": {
          "0%": { opacity: "0" },
          "100%": { opacity: "1" },
        },
        // ... –¥–µ—Å—è—Ç–∫–∏ keyframes
      },
    },
  },
};
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–†–∞–∑–±–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –Ω–∞ –º–æ–¥—É–ª–∏:**

```typescript
// tailwind.config/colors.ts
export const customColors = {
  primary: { /* ... */ },
  accent: { /* ... */ },
  // ...
};

// tailwind.config/animations.ts
export const customAnimations = {
  animation: { /* ... */ },
  keyframes: { /* ... */ },
};

// tailwind.config.ts
import { customColors } from './tailwind.config/colors';
import { customAnimations } from './tailwind.config/animations';

const config: Config = {
  theme: {
    extend: {
      colors: customColors,
      ...customAnimations,
    },
  },
};
```

2. **–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é –ø–∞–ª–∏—Ç—Ä—É:**

–°–æ–∑–¥–∞—Ç—å `docs/design-system/colors.md` —Å –≤–∏–∑—É–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏ –≤—Å–µ—Ö —Ü–≤–µ—Ç–æ–≤.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3 (–ù–∏–∑–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (1 –¥–µ–Ω—å)
**–í–ª–∏—è–Ω–∏–µ:** Maintainability

---

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 4.1. –ü–æ–∫—Ä—ã—Ç–∏–µ –¢–µ—Å—Ç–∞–º–∏

**–°—Ç–∞—Ç—É—Å:** üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**

**–ù–∞—Ö–æ–¥–∫–∏:**

- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 68 (40 –≤ `src/`, 28 –≤ `tests/`)
- **Stores:** –¢–æ–ª—å–∫–æ 1 —Ç–µ—Å—Ç (`audioPlayerStore.test.ts`), **dawStore.ts (1158 —Å—Ç—Ä–æ–∫) –Ω–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è!**
- **Hooks:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- **Services:** –ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ
- **Components:** –ß–∞—Å—Ç–∏—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã:**

1. **dawStore.ts (1,158 —Å—Ç—Ä–æ–∫) - 0% –ø–æ–∫—Ä—ã—Ç–∏—è**
   - 40+ –º–µ—Ç–æ–¥–æ–≤ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤
   - –†–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å undo/redo, clipboard operations, clip splitting

2. **api.service.ts (563 —Å—Ç—Ä–æ–∫–∏) - –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ**
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ç—Ä–µ–∫–∏, –±–∞–ª–∞–Ω—Å, —Å—Ç–µ–º—ã)
   - –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è error handling
   - –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è retry logic

3. **useGenerateMusic (471 —Å—Ç—Ä–æ–∫–∞) - –ø–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ**
   - –°–ª–æ–∂–Ω–∞—è state machine (idle ‚Üí generating ‚Üí completed/failed)
   - –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è polling fallback
   - –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è rate limiting
   - –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è subscription logic

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

**–®–∞–≥ 1: –ò–∑–º–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**

```bash
npm test -- --coverage
```

**–¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **Statements:** 80%+
- **Branches:** 75%+
- **Functions:** 80%+
- **Lines:** 80%+

**–®–∞–≥ 2: –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ | –¶–µ–ª–µ–≤–æ–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-----------|-----------|------------------|---------|-----------|
| **dawStore.ts** | P0 | 0% | 80%+ | –í—ã—Å–æ–∫–∞—è (3-5 –¥–Ω–µ–π) |
| **api.service.ts** | P0 | ? | 80%+ | –°—Ä–µ–¥–Ω—è—è (2-3 –¥–Ω—è) |
| **useGenerateMusic** | P1 | ? | 75%+ | –°—Ä–µ–¥–Ω—è—è (2-3 –¥–Ω—è) |
| **SupabaseFunctions** | P1 | ? | 90%+ | –ù–∏–∑–∫–∞—è (1 –¥–µ–Ω—å) |
| **Component tests** | P2 | ? | 70%+ | –ù–∏–∑–∫–∞—è (ongoing) |

**–®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è dawStore (–ø—Ä–∏–º–µ—Ä)**

```typescript
// src/stores/__tests__/dawStore.project.test.ts
import { renderHook, act } from '@testing-library/react';
import { useDAWStore } from '../dawStore';

describe('dawStore - Project Actions', () => {
  beforeEach(() => {
    // Reset store before each test
    const { result } = renderHook(() => useDAWStore());
    act(() => {
      useDAWStore.setState({
        project: null,
        history: [],
        historyIndex: -1,
      });
    });
  });

  describe('createProject', () => {
    it('should create a new project with default settings', () => {
      const { result } = renderHook(() => useDAWStore());

      act(() => {
        result.current.createProject('My Project');
      });

      expect(result.current.project).not.toBeNull();
      expect(result.current.project?.name).toBe('My Project');
      expect(result.current.project?.bpm).toBe(120);
      expect(result.current.project?.tracks).toHaveLength(1); // Master track
      expect(result.current.project?.tracks[0].type).toBe('master');
    });

    it('should initialize history with the new project', () => {
      const { result } = renderHook(() => useDAWStore());

      act(() => {
        result.current.createProject('Test');
      });

      expect(result.current.history).toHaveLength(1);
      expect(result.current.historyIndex).toBe(0);
      expect(result.current.history[0]).toEqual(result.current.project);
    });
  });

  describe('updateProjectName', () => {
    it('should update project name and push to history', () => {
      const { result } = renderHook(() => useDAWStore());

      act(() => {
        result.current.createProject('Original');
      });

      const originalUpdatedAt = result.current.project?.updated_at;

      act(() => {
        result.current.updateProjectName('Updated');
      });

      expect(result.current.project?.name).toBe('Updated');
      expect(result.current.project?.updated_at).not.toBe(originalUpdatedAt);
      expect(result.current.history).toHaveLength(2);
      expect(result.current.historyIndex).toBe(1);
    });
  });

  describe('updateBPM', () => {
    it('should update BPM and push to history', () => {
      const { result } = renderHook(() => useDAWStore());

      act(() => {
        result.current.createProject('Test');
        result.current.updateBPM(140);
      });

      expect(result.current.project?.bpm).toBe(140);
      expect(result.current.history).toHaveLength(2);
    });
  });
});

// src/stores/__tests__/dawStore.tracks.test.ts
describe('dawStore - Track Actions', () => {
  // ... —Ç–µ—Å—Ç—ã –¥–ª—è addTrack, removeTrack, updateTrack, duplicateTrack
});

// src/stores/__tests__/dawStore.clips.test.ts
describe('dawStore - Clip Actions', () => {
  describe('splitClip', () => {
    it('should split clip into two at specified time', () => {
      const { result } = renderHook(() => useDAWStore());

      act(() => {
        result.current.createProject('Test');
        result.current.addTrack('audio', 'Audio 1');

        const trackId = result.current.project!.tracks[1].id;
        result.current.addClip(trackId, {
          name: 'Clip 1',
          audioUrl: 'test.mp3',
          startTime: 0,
          duration: 10,
          offset: 0,
          volume: 1.0,
          fadeIn: 0,
          fadeOut: 0,
        });
      });

      const clip = result.current.project!.tracks[1].clips[0];

      act(() => {
        result.current.splitClip(clip.id, 5); // Split at 5 seconds
      });

      const clips = result.current.project!.tracks[1].clips;
      expect(clips).toHaveLength(2);

      // Left clip
      expect(clips[0].duration).toBe(5);
      expect(clips[0].startTime).toBe(0);

      // Right clip
      expect(clips[1].duration).toBe(5);
      expect(clips[1].startTime).toBe(5);
      expect(clips[1].offset).toBe(5);
    });

    it('should not split if time is outside clip bounds', () => {
      // ... test edge cases
    });
  });
});

// src/stores/__tests__/dawStore.undo-redo.test.ts
describe('dawStore - Undo/Redo', () => {
  it('should undo last action', () => {
    const { result } = renderHook(() => useDAWStore());

    act(() => {
      result.current.createProject('Test');
      result.current.updateProjectName('Version 1');
      result.current.updateProjectName('Version 2');
    });

    expect(result.current.project?.name).toBe('Version 2');
    expect(result.current.historyIndex).toBe(2);

    act(() => {
      result.current.undo();
    });

    expect(result.current.project?.name).toBe('Version 1');
    expect(result.current.historyIndex).toBe(1);
  });

  it('should redo after undo', () => {
    const { result } = renderHook(() => useDAWStore());

    act(() => {
      result.current.createProject('Test');
      result.current.updateBPM(140);
      result.current.undo();
    });

    expect(result.current.project?.bpm).toBe(120);

    act(() => {
      result.current.redo();
    });

    expect(result.current.project?.bpm).toBe(140);
  });

  it('should limit history to 50 states', () => {
    const { result } = renderHook(() => useDAWStore());

    act(() => {
      result.current.createProject('Test');

      // Push 60 states
      for (let i = 0; i < 60; i++) {
        result.current.updateBPM(120 + i);
      }
    });

    expect(result.current.history.length).toBeLessThanOrEqual(50);
  });
});
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è (1-2 –Ω–µ–¥–µ–ª–∏ –¥–ª—è 80% –ø–æ–∫—Ä—ã—Ç–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏)
**–í–ª–∏—è–Ω–∏–µ:** Quality, Stability, Confidence in refactoring

---

### 5. Performance –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

#### 5.1. Bundle Size

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–ù–µ –∏–∑–º–µ—Ä–µ–Ω**

**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–Ω–¥–ª–∞

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å bundle analysis:**
   ```bash
   npm run build:analyze
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—é–¥–∂–µ—Ç—ã –¥–ª—è chunks:**
   ```typescript:vite.config.ts
   build: {
     chunkSizeWarningLimit: 800, // KB
     rollupOptions: {
       output: {
         manualChunks: {
           'vendor-ui': ['@radix-ui/react-dialog', '@radix-ui/react-dropdown-menu', ...],
           'vendor-charts': ['recharts'],
           'vendor-motion': ['framer-motion'],
           'vendor-supabase': ['@supabase/supabase-js'],
           'vendor-query': ['@tanstack/react-query'],
         },
       },
     },
   }
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å lazy loading routes:**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã lazy-loaded
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç—è–∂–µ–ª—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (recharts, framer-motion) –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1 (–í—ã—Å–æ–∫–∏–π)
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (1 –¥–µ–Ω—å)
**–í–ª–∏—è–Ω–∏–µ:** Performance, UX

---

#### 5.2. React Query Caching

**–°—Ç–∞—Ç—É—Å:** üü¢ **–•–æ—Ä–æ—à–æ**

**–ù–∞—Ö–æ–¥–∫–∏:**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è TanStack Query —Å –∞–¥–µ–∫–≤–∞—Ç–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:

```typescript
// Desktop: 5-minute cache, 3 retries
// Mobile: 2-minute cache, 2 retries
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

---

### 6. Security

#### 6.1. Input Sanitization

**–°—Ç–∞—Ç—É—Å:** üü¢ **–•–æ—Ä–æ—à–æ**

**–ù–∞—Ö–æ–¥–∫–∏:**

–í `useGenerateMusic` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```typescript:src/hooks/useGenerateMusic.ts
const sanitizedOptions: GenerationRequest = {
  ...options,
  prompt: sanitizePrompt(options.prompt || ''),
  title: options.title ? sanitizeTitle(options.title) : undefined,
  lyrics: options.lyrics ? sanitizeLyrics(options.lyrics) : undefined,
};
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ.

---

#### 6.2. Environment Variables

**–°—Ç–∞—Ç—É—Å:** üü¢ **–•–æ—Ä–æ—à–æ**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Zod –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `src/config/env.ts`.

---

## üìà Roadmap –∏ –ü–ª–∞–Ω –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 0: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –§–∞–π–ª | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π |
|--------|------|-----------|-------|---------------|
| **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è dawStore** | `dawStore.ts` | –í—ã—Å–æ–∫–∞—è | 5-7 –¥–Ω–µ–π | Backend lead |
| **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ ApiService** | `api.service.ts` | –°—Ä–µ–¥–Ω—è—è | 2-3 –¥–Ω—è | Backend dev |
| **–£–±—Ä–∞—Ç—å monkey-patching Supabase** | `client.ts` | –°—Ä–µ–¥–Ω—è—è | 1-2 –¥–Ω—è | Infra lead |
| **–¢–µ—Å—Ç—ã –¥–ª—è dawStore** | `__tests__/dawStore.*.test.ts` | –í—ã—Å–æ–∫–∞—è | 3-5 –¥–Ω–µ–π | QA/Dev |
| **–¢–µ—Å—Ç—ã –¥–ª—è ApiService** | `__tests__/api.service.test.ts` | –°—Ä–µ–¥–Ω—è—è | 2-3 –¥–Ω—è | QA/Dev |

**–ò—Ç–æ–≥–æ:** 13-20 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (2-3 –Ω–µ–¥–µ–ª–∏ —Å —É—á–µ—Ç–æ–º parallelization)

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –£–ª—É—á—à–µ–Ω–∏–µ (2-3 –Ω–µ–¥–µ–ª–∏)

| –ó–∞–¥–∞—á–∞ | –§–∞–π–ª | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π |
|--------|------|-----------|-------|---------------|
| **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ useGenerateMusic** | `useGenerateMusic.ts` | –°—Ä–µ–¥–Ω—è—è | 2-3 –¥–Ω—è | Frontend lead |
| **–ê—É–¥–∏—Ç –∏ —á–∏—Å—Ç–∫–∞ hooks** | `src/hooks/` | –°—Ä–µ–¥–Ω—è—è | 3-5 –¥–Ω–µ–π | Frontend team |
| **–û—á–∏—Å—Ç–∫–∞ features/tracks** | `src/features/tracks/` | –í—ã—Å–æ–∫–∞—è | 2-3 –¥–Ω—è | Frontend lead |
| **Bundle size –∞–Ω–∞–ª–∏–∑** | - | –ù–∏–∑–∫–∞—è | 1 –¥–µ–Ω—å | DevOps |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** | `docs/design-system/` | –ù–∏–∑–∫–∞—è | 1 –¥–µ–Ω—å | Designer/Dev |

**–ò—Ç–æ–≥–æ:** 9-13 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

---

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –†–∞–∑–≤–∏—Ç–∏–µ (ongoing)

| –ó–∞–¥–∞—á–∞ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|--------|-----------|-------|
| **Storybook –¥–ª—è UI components** | –°—Ä–µ–¥–Ω—è—è | 3-5 –¥–Ω–µ–π |
| **Performance monitoring** | –ù–∏–∑–∫–∞—è | 1-2 –¥–Ω—è |
| **Accessibility audit (WCAG AA)** | –°—Ä–µ–¥–Ω—è—è | 3-5 –¥–Ω–µ–π |
| **E2E —Ç–µ—Å—Ç—ã (Playwright)** | –°—Ä–µ–¥–Ω—è—è | Ongoing |
| **Code coverage –¥–æ 80%** | –í—ã—Å–æ–∫–∞—è | Ongoing |

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞ (KPI)

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª—å |
|---------|---------|------|
| **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ~150 —Å—Ç—Ä–æ–∫ | <100 —Å—Ç—Ä–æ–∫ |
| **Max —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | 1,158 —Å—Ç—Ä–æ–∫ | <300 —Å—Ç—Ä–æ–∫ |
| **Test coverage** | ~40-50% | >80% |
| **Bundle size (gzip)** | ? | <500 KB initial |
| **Lighthouse Performance** | ? | >90 |
| **Time to Interactive** | ? | <3s |
| **First Contentful Paint** | ? | <1.5s |
| **API error rate** | ? | <1% |
| **Sentry errors/week** | ? | <10 |

---

## üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### CI/CD Checks (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

```yaml
# .github/workflows/quality.yml
name: Code Quality

on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install dependencies
        run: npm ci

      - name: Type check
        run: npm run typecheck

      - name: Lint
        run: npm run lint

      - name: Test with coverage
        run: npm test -- --coverage

      - name: Check coverage thresholds
        run: |
          # Fail if coverage < 80%
          npm run test:coverage-check

      - name: Bundle size check
        run: npm run bundle:check

      - name: Build
        run: npm run build
```

### Pre-commit Hooks

```json:package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm run typecheck && npm test"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ]
  }
}
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç Albert3 Muse Synth Studio –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **—Å–∏–ª—å–Ω—É—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –±–∞–∑—É** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –∏ best practices. –û–¥–Ω–∞–∫–æ –≤—ã—è–≤–ª–µ–Ω—ã **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ä—Ö–∏—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:

- **–°–Ω–∏–∂–µ–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** (–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ stores —Å –ª–∏—à–Ω–∏–º–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞–º–∏)
- **–£—Å–ª–æ–∂–Ω–µ–Ω–∏—é –ø–æ–¥–¥–µ—Ä–∂–∫–∏** (God Classes, 1000+ —Å—Ç—Ä–æ–∫ —Ñ–∞–π–ª—ã)
- **–†–∏—Å–∫—É —Ä–µ–≥—Ä–µ—Å—Å–∏–π** (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –¥–æ–ª–≥—É** (monkey-patching, –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞)

### –ö–ª—é—á–µ–≤—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:** –†–∞–∑–±–∏—Ç—å `dawStore.ts` –∏ `api.service.ts` –Ω–∞ –º–æ–¥—É–ª–∏
2. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ª–æ–≥–∏–∫—É (dawStore, ApiService, useGenerateMusic)
3. **–í–∞–∂–Ω–æ:** –£–±—Ä–∞—Ç—å monkey-patching Supabase, –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ wrapper pattern
4. **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ:** –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å `features/tracks`, –Ω–∞–≤–µ—Å—Ç–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ hooks
5. **Ongoing:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—É, –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å bundle size

### –ò—Ç–æ–≥–æ–≤–∞—è –û—Ü–µ–Ω–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | 6/10 | –•–æ—Ä–æ—à–∞—è –±–∞–∑–∞, –Ω–æ –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏ |
| **–ö–æ–¥ Quality** | 7/10 | TypeScript, –Ω–æ –µ—Å—Ç—å anti-patterns |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | 4/10 | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏ |
| **UI/UX** | 8/10 | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω, —Ö–æ—Ä–æ—à–∞—è –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ |
| **Performance** | 7/10 | React Query –ø–æ–º–æ–≥–∞–µ—Ç, –Ω–æ –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **Security** | 8/10 | –•–æ—Ä–æ—à–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è, RLS, env validation |
| **Documentation** | 7/10 | –û—Ç–ª–∏—á–Ω–∞—è CLAUDE.md, –Ω–æ –Ω–µ—Ç UI docs |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: 6.5/10**

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω:** 2025-11-19
**–°–ª–µ–¥—É—é—â–∏–π –∞—É–¥–∏—Ç:** 2025-12-19 (—á–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
**–ö–æ–Ω—Ç–∞–∫—Ç—ã:** –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ HOW2AI-AGENCY
