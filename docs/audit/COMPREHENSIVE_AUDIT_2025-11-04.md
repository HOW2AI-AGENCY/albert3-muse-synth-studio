# üîç –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç Albert3 Muse Synth Studio

**–î–∞—Ç–∞**: 4 –Ω–æ—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è**: 1.0.0
**–ê—É–¥–∏—Ç–æ—Ä**: Claude Code
**–°—Ç–∞—Ç—É—Å**: –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#1-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—É–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫–∏](#2-–∞—É–¥–∏—Ç-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-–∏-–ª–æ–≥–∏–∫–∏)
3. [–ê—É–¥–∏—Ç —Ñ–æ—Ä–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏](#3-–∞—É–¥–∏—Ç-—Ñ–æ—Ä–º—ã-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏-–º—É–∑—ã–∫–∏)
4. [–ê—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (Suno API, Replicate)](#4-–∞—É–¥–∏—Ç-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)
5. [–ê—É–¥–∏—Ç –ª–µ–Ω—Ç—ã —Ç—Ä–µ–∫–æ–≤](#5-–∞—É–¥–∏—Ç-–ª–µ–Ω—Ç—ã-—Ç—Ä–µ–∫–æ–≤)
6. [–ê—É–¥–∏—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã](#6-–∞—É–¥–∏—Ç-–¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã)
7. [–ê—É–¥–∏—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö](#7-–∞—É–¥–∏—Ç-–º–æ–±–∏–ª—å–Ω–æ–π-–∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏)
8. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#8-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
9. [–ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫](#9-–ø–ª–∞–Ω-–¥–æ—Ä–∞–±–æ—Ç–æ–∫)
10. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#10-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### 1.1 –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Frontend:**
- React 18.3.1 + TypeScript 5.8.3
- Vite 7.1.12 (—Å–±–æ—Ä–∫–∞)
- Tailwind CSS + shadcn/ui + Radix UI
- TanStack Query 6.0.14 (—Å–µ—Ä–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- Zustand (–∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
- Framer Motion (–∞–Ω–∏–º–∞—Ü–∏–∏)

**Backend:**
- Supabase (BaaS)
- Deno Edge Functions
- PostgreSQL + Row Level Security
- Realtime subscriptions

**AI –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- Suno AI (sunoapi.org) - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏
- Mureka - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- Replicate.com - –∞–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ

### 1.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

‚úÖ **–•–æ—Ä–æ—à–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ:**
- Provider Adapter Pattern —Å —Ñ–∞–±—Ä–∏–∫–æ–π –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- Singleton –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä-–∞–¥–∞–ø—Ç–µ—Ä–æ–≤
- Track Versioning System (—Ç—Ä–µ–∫–∏ + –≤–µ—Ä—Å–∏–∏)
- Centralized Logger —Å Sentry –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- IndexedDB –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `trackCacheService`
- Realtime subscriptions –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –≤–Ω–∏–º–∞–Ω–∏—è:**
- –°–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ (–º–Ω–æ–∂–µ—Å—Ç–≤–æ useState)
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

---

## 2. –ê—É–¥–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫–∏

### 2.1 Provider Factory System

**–§–∞–π–ª**: `src/services/providers/factory.ts`

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **Singleton Pattern —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
   ```typescript
   private static adapters = new Map<MusicProvider, IProviderClient>();
   ```
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∞–¥–∞–ø—Ç–µ—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

2. **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (`IProviderClient`) –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
   - –ê–¥–∞–ø—Ç–µ—Ä—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö (`suno.adapter.ts`, `mureka.adapter.ts`)

3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `logger`
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞**
   - –ï—Å–ª–∏ Suno –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ fallback –Ω–∞ Mureka
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞**
   - Mureka –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç reference audio
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ UI, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–¥–∞–ø—Ç–µ—Ä–∞

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// 1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
static async getHealthyProvider(): Promise<IProviderClient> {
  const providers = this.getSupportedProviders();
  for (const provider of providers) {
    const adapter = this.getProvider(provider);
    if (await adapter.checkHealth()) {
      return adapter;
    }
  }
  throw new Error('No healthy providers available');
}

// 2. –î–æ–±–∞–≤–∏—Ç—å capabilities –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
interface IProviderClient {
  capabilities: {
    referenceAudio: boolean;
    personas: boolean;
    stems: boolean;
  };
  // ...
}
```

### 2.2 Track Versioning System

**–¢–∞–±–ª–∏—Ü—ã**: `tracks`, `track_versions`, `track_stems`

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `tracks`
   - –í–∞—Ä–∏–∞–Ω—Ç—ã –≤ `track_versions`
   - –°—Ç–µ–º—ã –≤ `track_stems`

2. **–ú–∞—Å—Ç–µ—Ä-–≤–µ—Ä—Å–∏—è**
   - `is_primary_variant` –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –≤–µ—Ä—Å–∏–∏
   - `is_preferred_variant` –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

**–ö–†–ò–¢–ò–ß–ù–û**: –û–±–Ω–∞—Ä—É–∂–µ–Ω –±–∞–≥ –≤ `ARCHITECTURE.md:136`:
> "–ü—Ä–æ–±–ª–µ–º–∞: **–û–±–Ω–∞—Ä—É–∂–µ–Ω –±–∞–≥**, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è. –¢—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è."

**–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã:**
- –§–∞–π–ª: `src/features/tracks/components/TrackCard.tsx`
- Hook: `useTrackCardState` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–µ—Ä—Å–∏–∏
- –í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ `is_primary_variant`

**–§–∞–π–ª**: `src/hooks/useTrackVersions.ts` (–Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞)

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ —Å –≤–µ—Ä—Å–∏—è–º–∏**
2. **–î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏**
3. **–£–ª—É—á—à–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –≤ –ë–î**:
   ```sql
   CREATE INDEX idx_track_versions_parent_track_id
   ON track_versions(parent_track_id) WHERE audio_url IS NOT NULL;
   ```

### 2.3 State Management

#### Zustand Stores:

**1. `audioPlayerStore.ts`** ‚úÖ
- –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω
- –ß–µ—Ç–∫–∏–µ actions –∏ reducers
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

**2. `useMusicGenerationStore.ts`** ‚ö†Ô∏è
- –ü—Ä–æ—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (provider, settings)
- –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è draft –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

#### TanStack Query:

**–§–∞–π–ª**: `src/hooks/useTracks.ts` ‚úÖ

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- Infinite scroll —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- Realtime subscriptions
- IndexedDB –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Polling –¥–ª—è processing —Ç—Ä–µ–∫–æ–≤

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –æ–¥–Ω–æ–º —Ö—É–∫–µ (300+ —Å—Ç—Ä–æ–∫)
- –ú–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ö—É–∫–∏:
  - `useTracksQuery` - –∑–∞–≥—Ä—É–∑–∫–∞
  - `useTracksRealtime` - –ø–æ–¥–ø–∏—Å–∫–∏
  - `useTracksPolling` - polling
  - `useTracksMutations` - –º—É—Ç–∞—Ü–∏–∏

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// –†–∞–∑–¥–µ–ª–∏—Ç—å useTracks.ts –Ω–∞ –º–æ–¥—É–ª–∏:
src/hooks/tracks/
  ‚îú‚îÄ‚îÄ useTracksQuery.ts       // –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å
  ‚îú‚îÄ‚îÄ useTracksRealtime.ts    // Realtime –ø–æ–¥–ø–∏—Å–∫–∏
  ‚îú‚îÄ‚îÄ useTracksPolling.ts     // Polling –ª–æ–≥–∏–∫–∞
  ‚îú‚îÄ‚îÄ useTracksMutations.ts   // Delete, update –∏ —Ç.–¥.
  ‚îî‚îÄ‚îÄ index.ts                // –≠–∫—Å–ø–æ—Ä—Ç
```

---

## 3. –ê—É–¥–∏—Ç —Ñ–æ—Ä–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏

### 3.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `MusicGeneratorV2.tsx` - —ç–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `MusicGeneratorContainer.tsx` - –ª–æ–≥–∏–∫–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (150 —Å—Ç—Ä–æ–∫)
- `MusicGeneratorContent.tsx` - UI —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (150 —Å—Ç—Ä–æ–∫)

**–§–æ—Ä–º—ã:**
- `SimpleModeCompact.tsx` - –ø—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º
- `CompactCustomForm.tsx` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ä–µ–∂–∏–º

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ Container/Content** (Presentation/Container pattern)
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ö—É–∫–∏** –≤ `src/components/generator/hooks/`:
   - `useGeneratorState.ts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
   - `useAudioUploadHandler.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ
   - `usePendingGenerationLoader.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö
   - `useStemReferenceLoader.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–µ–º–æ–≤
   - `useMurekaLyricsSubscription.ts` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–µ–∫—Å—Ç—ã Mureka

3. **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è** –∫–æ–ª–±–µ–∫–æ–≤ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

### 3.2 –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤

**–§–∞–π–ª—ã**: `CompactHeader.tsx`, `MusicGeneratorContent.tsx`

**–†–µ–∂–∏–º—ã:**
- `simple` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π UI
- `custom` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π UI

**–ü—Ä–æ–±–ª–µ–º–∞**:

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–µ–≤–∏–¥–Ω–æ** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```tsx
// CompactHeader.tsx - –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
<button onClick={() => onModeChange('simple')}>
  –ü—Ä–æ—Å—Ç–æ–π
</button>
<button onClick={() => onModeChange('custom')}>
  –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π
</button>
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
1. –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
2. –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
3. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç tooltip —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// –£–ª—É—á—à–µ–Ω–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Ä–µ–∂–∏–º–∞
<ToggleGroup type="single" value={mode} onValueChange={onModeChange}>
  <ToggleGroupItem value="simple" aria-label="–ü—Ä–æ—Å—Ç–æ–π —Ä–µ–∂–∏–º">
    <Sparkles className="mr-2 h-4 w-4" />
    <span>–ü—Ä–æ—Å—Ç–æ–π</span>
    <InfoTooltip>–ú–∏–Ω–∏–º—É–º –Ω–∞—Å—Ç—Ä–æ–µ–∫, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</InfoTooltip>
  </ToggleGroupItem>
  <ToggleGroupItem value="custom" aria-label="–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π">
    <Settings className="mr-2 h-4 w-4" />
    <span>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π</span>
    <InfoTooltip>–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</InfoTooltip>
  </ToggleGroupItem>
</ToggleGroup>
```

### 3.3 –ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã–±–æ—Ä–µ

**–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏:**

#### 3.3.1 –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `AudioSourceDialog.tsx`

**–ü–æ—Ç–æ–∫:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ ‚Üí `audioSourceDialogOpen={true}`
2. –í—ã–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫:
   - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞—É–¥–∏–æ
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
   - –í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞
3. Callback: `onAudioSelect(url, fileName)` –∏–ª–∏ `onTrackSelect(track)`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ Container:**
```tsx
// MusicGeneratorContainer.tsx:151+
const handleAudioSelect = useCallback((url: string, fileName: string) => {
  state.setParams(prev => ({
    ...prev,
    referenceAudioUrl: url,
    referenceFileName: fileName,
    referenceTrackId: null
  }));
}, [state]);
```

‚úÖ **–•–æ—Ä–æ—à–æ**: –ß–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç—Ä–µ–∫–∞ –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ - URL –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–º (signed URL —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º)

#### 3.3.2 –ü–µ—Ä—Å–æ–Ω–∞ (Persona)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `PersonaPickerDialog.tsx`

**–ü–æ—Ç–æ–∫:**
1. –î–∏–∞–ª–æ–≥ ‚Üí –≤—ã–±–æ—Ä –ø–µ—Ä—Å–æ–Ω—ã –∏–∑ —Å–ø–∏—Å–∫–∞
2. Callback: `onPersonaSelect(personaId)`

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```tsx
const handlePersonaSelect = useCallback((personaId: string | null) => {
  state.setParam('personaId', personaId);
  setPersonaDialogOpen(false);
}, [state]);
```

‚úÖ **–•–æ—Ä–æ—à–æ**: –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω—ã –¥–ª—è preview:
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–º—è –ø–µ—Ä—Å–æ–Ω—ã –≤ UI
- –ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è/—Ç–µ–≥–æ–≤ –ø–µ—Ä—Å–æ–Ω—ã

#### 3.3.3 –ü—Ä–æ–µ–∫—Ç

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `ProjectSelectorDialog.tsx`

**–ü–æ—Ç–æ–∫:**
1. –í—ã–±–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
2. Callback: `onProjectSelect(projectId)`

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```tsx
const handleProjectSelect = useCallback((projectId: string | null) => {
  state.setParam('activeProjectId', projectId);
  setProjectDialogOpen(false);
}, [state]);
```

‚úÖ **–•–æ—Ä–æ—à–æ**: –†–∞–±–æ—Ç–∞–µ—Ç

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞ **–Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è** –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- –ù–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è prompt –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- –ù–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Ç–µ–≥–∏ –ø—Ä–æ–µ–∫—Ç–∞
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

#### 3.3.4 –¢—Ä–µ–∫ (–¥–ª—è extend/cover)

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `AudioSourceDialog.tsx` ‚Üí `ReferenceTrackSelector`

**–ü–æ—Ç–æ–∫:**
1. –í—ã–±–æ—Ä —Ç—Ä–µ–∫–∞
2. Callback: `onReferenceTrackSelect(track)`

**–û–±—Ä–∞–±–æ—Ç–∫–∞:**
```tsx
const handleReferenceTrackSelect = useCallback((track: any) => {
  // –ï—Å–ª–∏ –µ—Å—Ç—å stem - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
  // –ò–Ω–∞—á–µ - –æ—Å–Ω–æ–≤–Ω–æ–π –∞—É–¥–∏–æ URL
  state.setParams(prev => ({
    ...prev,
    referenceAudioUrl: stemUrl || track.audio_url,
    referenceFileName: track.title || 'Reference Track',
    referenceTrackId: track.id
  }));
}, [state]);
```

‚úÖ **–•–æ—Ä–æ—à–æ**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç–µ–º–æ–≤

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö:

**1. –£–ª—É—á—à–∏—Ç—å preview –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
```tsx
// QuickActionsBar - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
{hasPersona && selectedPersonaDetails && (
  <Card className="p-2 text-xs">
    <div className="font-medium">{selectedPersonaDetails.name}</div>
    <div className="text-muted-foreground">{selectedPersonaDetails.description}</div>
  </Card>
)}
```

**2. –ü–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ:**
```tsx
const handleProjectSelect = async (projectId: string) => {
  const project = await fetchProjectDetails(projectId);

  state.setParams(prev => ({
    ...prev,
    activeProjectId: projectId,
    prompt: prev.prompt || project.description, // –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å, –µ—Å–ª–∏ –ø—É—Å—Ç–æ
    style_tags: [...prev.style_tags, ...project.tags] // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–≥–∏
  }));
};
```

**3. –î–æ–±–∞–≤–∏—Ç—å "—É–º–Ω—É—é" –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø–µ—Ä—Å–æ–Ω—ã:**
```tsx
const handlePersonaSelect = async (personaId: string) => {
  const persona = await fetchPersonaDetails(personaId);

  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å prompt –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω—ã
  if (!state.params.prompt && persona.description) {
    state.setParam('prompt', persona.description);
  }

  state.setParam('personaId', personaId);
};
```

### 3.4 –°–æ—Å—Ç–æ—è–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

**Hook**: `useGeneratorState.ts`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
```typescript
{
  mode: 'simple' | 'custom';
  params: {
    prompt: string;
    lyrics: string;
    style_tags: string[];
    // ... 15+ –ø–æ–ª–µ–π
  };
  debouncedPrompt: string;
  debouncedLyrics: string;
  enhancedPrompt: string | null;
  // ... –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π
}
```

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Ö—É–∫–µ

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

**–í—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:**
```typescript
// –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞:
1. GenerationParamsContext - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
2. UIStateContext - —Å–æ—Å—Ç–æ—è–Ω–∏–µ UI (–¥–∏–∞–ª–æ–≥–∏, —Ä–µ–∂–∏–º—ã)
3. EnhancedPromptContext - AI —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
```

---

## 4. –ê—É–¥–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### 4.1 Suno API Integration

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä**: sunoapi.org
**–§–∞–π–ª—ã**:
- Backend: `supabase/functions/_shared/suno.ts` (Protected file ‚ö†Ô∏è)
- Frontend Adapter: `src/services/providers/adapters/suno.adapter.ts`

#### API Endpoints –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ:

```typescript
// –°—Ö–µ–º–∞ –∏–∑ suno.ts:1-100
interface SunoGenerationPayload {
  prompt: string;
  tags?: string[];
  title?: string;
  customMode?: boolean;
  make_instrumental?: boolean;
  model?: "V3_5" | "V4" | "V4_5" | "V4_5PLUS" | "V5";
  referenceAudioUrl?: string;
  personaId?: string; // ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä—Å–æ–Ω
  callBackUrl?: string;
}
```

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Suno**:
   - –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ
   - –ü–µ—Ä—Å–æ–Ω—ã
   - –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–µ–∂–∏–º (custom lyrics)
   - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏

2. **Webhook —Å–∏—Å—Ç–µ–º–∞** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

3. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** (V3.5 - V5)

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API**:
   - –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ deprecation warnings
   - –ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ API

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞–¥–∞–ø—Ç–µ—Ä–∞

3. **Rate Limiting**:
   - –õ–∏–º–∏—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ `rateLimiter.ts`
   - –ù–æ –Ω–µ—Ç –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// 1. –î–æ–±–∞–≤–∏—Ç—å retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
class SunoProviderAdapter implements IProviderClient {
  private async retryWithBackoff<T>(
    fn: () => Promise<T>,
    maxRetries = 3
  ): Promise<T> {
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è retry –ª–æ–≥–∏–∫–∏
  }

  // 2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ API
  async checkApiVersion(): Promise<void> {
    // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –≤–µ—Ä—Å–∏–∏
  }

  // 3. Real-time –±–∞–ª–∞–Ω—Å
  async getRemainingCredits(): Promise<number> {
    // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
  }
}
```

### 4.2 Replicate Integration

**–§–∞–π–ª—ã**:
- Backend: `supabase/functions/_shared/replicate.ts`
- Edge Functions:
  - `analyze-audio/`
  - `analyze-audio-flamingo/`
  - `upscale-audio-sr/`

#### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏:

**–ò–∑ grep —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
- 8 —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Replicate
- –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: –∞–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ, –∞–ø—Å–∫–µ–π–ª

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç** `createReplicateClient`
2. **Webhook –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. **Timeout –∫–æ–Ω—Ç—Ä–æ–ª—å** (30 —Å–µ–∫—É–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–ª–æ**:
   - Replicate –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
   - –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

2. **–ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞**:
   - –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ = –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –∫—Ä–µ–¥–∏—Ç–æ–≤

3. **–ù–µ—Ç fallback** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö Replicate

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∞—É–¥–∏–æ
interface AudioAnalysisCache {
  file_hash: string;
  analysis_result: any;
  created_at: timestamp;
}

// 2. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
- Essentia.js (–ª–æ–∫–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- Web Audio API (BPM, –∫–ª—é—á)
- OpenAI Whisper (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è)

// 3. –î–æ–±–∞–≤–∏—Ç—å retry
const analyzeAudio = retryWithBackoff(
  () => replicate.run(model, input),
  { maxRetries: 3 }
);
```

### 4.3 Mureka Integration

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä**: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Suno
**–§–∞–π–ª**: `src/services/providers/adapters/mureka.adapter.ts`

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Mureka:

**–ò–∑ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞:**
```typescript
// MusicGeneratorContainer.tsx:80-98
if (selectedProvider === 'mureka' && prev.referenceAudioUrl) {
  logger.warn('Clearing reference audio for Mureka');

  toast({
    title: '‚ö†Ô∏è –†–µ—Ñ–µ—Ä–µ–Ω—Å —É–¥–∞–ª—ë–Ω',
    description: 'Mureka –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ'
  });

  return {
    ...newParams,
    referenceAudioUrl: null,
    // ...
  };
}
```

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
   - –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–≥–æ –∞—É–¥–∏–æ
   - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ–± –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö

2. **Lyrics Generation Flow**:
   - Mureka –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç—ã –≤ 2 —ç—Ç–∞–ø–∞
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞: `useMurekaLyricsSubscription`
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç —Ç–µ–∫—Å—Ç–∞

3. **UX –ø—Ä–æ–±–ª–µ–º–∞**: –ù–µ–ø–æ–Ω—è—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ—á–µ–º—É —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –∏—Å—á–µ–∑–∞–µ—Ç

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –£–ª—É—á—à–∏—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
<Alert variant="warning">
  <AlertTriangle className="h-4 w-4" />
  <AlertTitle>–í–Ω–∏–º–∞–Ω–∏–µ!</AlertTitle>
  <AlertDescription>
    Mureka –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
    ‚Ä¢ –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ
    ‚Ä¢ –ü–µ—Ä—Å–æ–Ω—ã Suno

    –≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
  </AlertDescription>
  <AlertActions>
    <Button onClick={confirmSwitch}>–î–∞, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å</Button>
    <Button variant="outline" onClick={cancelSwitch}>–û—Ç–º–µ–Ω–∞</Button>
  </AlertActions>
</Alert>

// 2. –ü–æ–∫–∞–∑–∞—Ç—å capabilities –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ UI
<ProviderBadges provider={selectedProvider}>
  {capabilities.referenceAudio && <Badge>–†–µ—Ñ–µ—Ä–µ–Ω—Å –∞—É–¥–∏–æ</Badge>}
  {capabilities.personas && <Badge>–ü–µ—Ä—Å–æ–Ω—ã</Badge>}
  {capabilities.stems && <Badge>–°—Ç–µ–º—ã</Badge>}
</ProviderBadges>
```

---

## 5. –ê—É–¥–∏—Ç –ª–µ–Ω—Ç—ã —Ç—Ä–µ–∫–æ–≤

### 5.1 TrackCard Component

**–§–∞–π–ª**: `src/features/tracks/components/TrackCard.tsx`

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –ø–æ–¥–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
   ```
   TrackCard/
   ‚îú‚îÄ‚îÄ TrackCardCover    - –æ–±–ª–æ–∂–∫–∞ —Ç—Ä–µ–∫–∞
   ‚îú‚îÄ‚îÄ TrackCardInfo     - –Ω–∞–∑–≤–∞–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
   ‚îú‚îÄ‚îÄ TrackCardActions  - –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
   ‚îî‚îÄ‚îÄ TrackCardStates   - —Å–æ—Å—Ç–æ—è–Ω–∏—è (loading, failed)
   ```

2. **Custom Hook** `useTrackCardState`:
   - –í—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏
   - Play/pause, like, download

3. **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: `React.memo()`

4. **–ê–Ω–∏–º–∞—Ü–∏–∏** Framer Motion:
   ```tsx
   <motion.div
     variants={fadeInUp}
     initial="initial"
     animate="animate"
   />
   ```

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã –ø–æ —Ç—Ä–µ–∫ ID** - —Ö–æ—Ä–æ—à–∏–π UX, –Ω–æ –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ:
   ```tsx
   const getGradientByTrackId = (trackId: string) => {
     const index = trackId.charCodeAt(0) % gradients.length;
     return gradients[index];
   };
   ```
   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: —Å–æ—Ö—Ä–∞–Ω—è—Ç—å gradient –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–∞

2. **–í–µ—Ä—Å–∏–∏ —Ç—Ä–µ–∫–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   –°–º. –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–±–ª–µ–º—É –≤ —Ä–∞–∑–¥–µ–ª–µ 2.2

3. **–ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–π UI –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö**:
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
   - –ú–µ–ª–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–∞–ø-—Ç–∞—Ä–≥–µ—Ç—ã (< 44px)

### 5.2 TracksList Component

**–§–∞–π–ª**: `src/components/TracksList.tsx`

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è**:
   - `VirtualizedTrackGrid` –¥–ª—è grid —Ä–µ–∂–∏–º–∞
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤

2. **–ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞**:
   - `useAdaptiveGrid` hook
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç—É—é DetailPanel

3. **–î–≤–∞ —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
   - Grid (—Å–µ—Ç–∫–∞)
   - List (—Å–ø–∏—Å–æ–∫)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **ResizeObserver** –¥–ª—è container dimensions:
   - –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä—ã
   - –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useBreakpoints` hook

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã—Ö —Ç—Ä–µ–∫–æ–≤**:
   ```tsx
   const playableTracks = useMemo(() =>
     tracks
       .filter(t => t.status === 'completed' && t.audio_url)
       .map(t => ({ /* ... */ })),
     [tracks]
   );
   ```
   –•–æ—Ä–æ—à–∞—è –º–µ–º–æ–∏–∑–∞—Ü–∏—è, –Ω–æ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
   - –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –∑–∞–ø—Ä–æ—Å–∞ (SQL WHERE)

3. **–ù–µ—Ç infinite scroll**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è, –Ω–æ –Ω–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - `useTracks` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç infinite query, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –î–æ–±–∞–≤–∏—Ç—å infinite scroll
<VirtualizedTrackGrid
  tracks={allTracks}
  hasNextPage={hasNextPage}
  fetchNextPage={fetchNextPage}
  isFetchingNextPage={isFetchingNextPage}
  onScrollEnd={() => {
    if (hasNextPage && !isFetchingNextPage) {
      fetchNextPage();
    }
  }}
/>

// 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–∫–æ–≤
const { data } = useInfiniteQuery({
  queryKey: ['tracks', userId, { onlyCompleted: true }],
  queryFn: ({ pageParam }) => fetchTracks({
    status: 'completed',
    hasAudioUrl: true,
    // ...
  })
});
```

### 5.3 Track Operations

**–§–∞–π–ª**: `src/hooks/tracks/useTrackOperations.ts`

**–û–ø–µ—Ä–∞—Ü–∏–∏:**
- Delete - —É–¥–∞–ª–µ–Ω–∏–µ
- Extend - –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
- Cover - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞–≤–µ—Ä–∞
- Separate Stems - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç–µ–º—ã
- Add Vocal - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–∫–∞–ª–∞
- Describe Track - –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞
- Create Persona - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω—ã –∏–∑ —Ç—Ä–µ–∫–∞

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Ç—Ä–µ–∫–∞–º–∏
2. **–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** (optimistic updates)
3. **Error handling** —Å toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Ç –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–∏** (undo):
   - –ü–æ—Å–ª–µ delete –Ω–µ–ª—å–∑—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
   - –ù–µ—Ç –∫–æ—Ä–∑–∏–Ω—ã

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:
   - Extend —Ç—Ä–µ–±—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–∞
   - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É (soft delete)
const deleteTrack = async (trackId: string) => {
  await supabase
    .from('tracks')
    .update({
      deleted_at: new Date().toISOString(),
      status: 'archived'
    })
    .eq('id', trackId);

  toast({
    title: '–¢—Ä–µ–∫ —É–¥–∞–ª–µ–Ω',
    action: (
      <Button onClick={() => restoreTrack(trackId)}>
        –û—Ç–º–µ–Ω–∏—Ç—å
      </Button>
    )
  });
};

// 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏–µ–π
const extendTrack = async (trackId: string) => {
  const track = await getTrack(trackId);

  if (!track.audio_url) {
    throw new Error('–¢—Ä–µ–∫ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω');
  }

  if (track.duration < 30) {
    throw new Error('–¢—Ä–µ–∫ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –¥–ª—è extend');
  }

  // ...
};
```

---

## 6. –ê—É–¥–∏—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã

### 6.1 Design Tokens

**–§–∞–π–ª**: `src/styles/design-tokens.css`

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è 2.1.0**:
   - –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤ (14px base –≤–º–µ—Å—Ç–æ 16px)
   - –¢–∞–π—Ç–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã (4px grid)
   - –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã (32px –≤—ã—Å–æ—Ç–∞)

2. **Comprehensive Token System**:
   - –¶–≤–µ—Ç–∞ (–æ—Å–Ω–æ–≤–Ω—ã–µ, –∞–∫—Ü–µ–Ω—Ç–Ω—ã–µ, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ)
   - –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ (—Ä–∞–∑–º–µ—Ä—ã, –≤–µ—Å–∞, line-height)
   - Spacing (–æ—Ç 4px –¥–æ 128px)
   - –†–∞–¥–∏—É—Å—ã —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è
   - –¢–µ–Ω–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã
   - –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã
   - Z-index layers

3. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã**:
   ```css
   /* Generator Specific */
   --generator-header-height: 3.25rem;  /* 52px */
   --generator-section-gap: 0.625rem;   /* 10px */
   --generator-field-gap: 0.5rem;       /* 8px */

   /* Mobile */
   --mobile-touch-min: 44px;  /* WCAG AAA */
   --generator-max-height-mobile: calc(100vh - 180px);
   ```

4. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —ç–∫—Ä–∞–Ω
   - –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   - –ö–æ–º—Ñ–æ—Ä—Ç –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**:
   - –ú–Ω–æ–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π
   - –ù–µ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–∫–µ–Ω—ã

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–º–Ω–æ–π/—Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã**:
   - –¢–æ–ª—å–∫–æ —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞
   - –ù–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è

3. **Semantic tokens –Ω–µ –≤–µ–∑–¥–µ**:
   ```css
   /* –ï—Å—Ç—å —Ç–æ–∫–µ–Ω—ã, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è */
   --spacing-card-padding: var(--space-4);
   --spacing-card-gap: var(--space-3);

   /* –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –≤—Å–µ –µ—â–µ —Ö–∞—Ä–¥–∫–æ–¥ */
   <Card className="p-6 gap-4"> {/* –í–º–µ—Å—Ç–æ semantic vars */}
   ```

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

**1. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
```tsx
// –î–æ:
<Card className="p-6 gap-4">

// –ü–æ—Å–ª–µ:
<Card className="card-primary"> {/* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç --spacing-card-padding */}
```

**2. –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞:**
```css
:root[data-theme="light"] {
  --background: 0 0% 100%;
  --foreground: 222 47% 11%;
  --surface: 210 20% 98%;
  /* ... */
}
```

**3. –ü–æ–ø–æ–ª–Ω–∏—Ç—å semantic tokens:**
```css
/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
--track-card-padding: var(--space-4);
--track-card-gap: var(--space-3);
--track-card-cover-size: 12rem;

/* Generator */
--generator-input-height: var(--control-height-md);
--generator-button-height: var(--control-height-sm);
```

### 6.2 shadcn/ui Components

**–ü–∞–ø–∫–∞**: `src/components/ui/`

**–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 60+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
   - Buttons, Inputs, Selects
   - Dialogs, Sheets, Drawers
   - Cards, Badges, Avatars
   - Tables, Tabs, Accordions
   - Charts, Progress, Sliders
   - Tooltips, Popovers, Dropdowns

2. **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
   - `VirtualizedList.tsx` - –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è
   - `LazyImage.tsx` - –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
   - `ProgressiveImage.tsx` - –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
   - `CompactSlider.tsx` - –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Å–ª–∞–π–¥–µ—Ä
   - `InfoTooltip.tsx` - –ø–æ–¥—Å–∫–∞–∑–∫–∏

3. **Accessibility**:
   - `AccessibleComponents.tsx`
   - `VisuallyHidden.tsx`
   - ARIA –∞—Ç—Ä–∏–±—É—Ç—ã

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã**:
   - `Dialog` –Ω–µ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `Sheet` –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   - `Dropdown` –º–µ–Ω—é –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏–º–∏

2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**:
   - `loading-state.tsx` –∏ `loading-states.tsx`
   - `Skeleton.tsx` –∏ `skeleton.tsx`

3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ mobile-friendly –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤**:
   - –ù–µ—Ç `BottomSheet` –æ–±–µ—Ä—Ç–∫–∏
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `SwipeableDrawer`

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏
<ResponsiveDialog
  desktop={<Dialog>...</Dialog>}
  mobile={<Sheet side="bottom">...</Sheet>}
/>

// 2. –ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
// –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª: src/components/ui/loading.tsx

// 3. Mobile-friendly –≤–∞—Ä–∏–∞–Ω—Ç—ã
<BottomSheet open={open} onOpenChange={setOpen}>
  <BottomSheetContent>
    {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
  </BottomSheetContent>
</BottomSheet>
```

### 6.3 Breakpoints System

**–§–∞–π–ª**: `src/config/breakpoints.config.ts` (Protected ‚ö†Ô∏è)

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **Single Source of Truth**:
   ```typescript
   export const BREAKPOINTS = {
     xs: 375,
     sm: 640,
     md: 768,
     lg: 1024,
     xl: 1280,
     '2xl': 1536,
     '3xl': 1920,
     '4k': 2560,
   } as const;
   ```

2. **Screen Categories**:
   - mobile, tablet, desktop, wide, ultrawide

3. **Utility —Ñ—É–Ω–∫—Ü–∏–∏**:
   - `mediaQuery(key, type)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å–æ–≤
   - `categoryQuery(category)` - –∑–∞–ø—Ä–æ—Å—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - `getScreenCategory(width)` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**:
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ö–∞—Ä–¥–∫–æ–¥ –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç—ã
   - Tailwind –∫–ª–∞—Å—Å—ã —Å —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

2. **Hook `useBreakpoints` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç config**:
   - –ú–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```typescript
// 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
import { BREAKPOINTS } from '@/config/breakpoints.config';

// –í–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
const isMobile = width < BREAKPOINTS.md;

// 2. Tailwind –∫–æ–Ω—Ñ–∏–≥ –¥–æ–ª–∂–µ–Ω –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å:
// tailwind.config.js
import { BREAKPOINTS } from './src/config/breakpoints.config';

export default {
  theme: {
    screens: BREAKPOINTS
  }
}
```

---

## 7. –ê—É–¥–∏—Ç –º–æ–±–∏–ª—å–Ω–æ–π –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏

### 7.1 –ù–∞–≤–∏–≥–∞—Ü–∏—è

**–§–∞–π–ª**: `docs/MOBILE_OPTIMIZATION.md`

#### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **Bottom Tab Bar** (`BottomTabBar.tsx`):
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–∞—Ö < 1024px
   - Haptic feedback
   - –ê–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
   - z-index: 40

2. **–°–∫—Ä—ã—Ç—ã–π Sidebar**:
   - –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–∫—Ä—ã—Ç–∞
   - –í—Å—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ BottomTabBar

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Ç –≥–∞–º–±—É—Ä–≥–µ—Ä-–º–µ–Ω—é**:
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
   - –ü—Ä–æ—Ñ–∏–ª—å, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - —Å–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏

2. **Bottom Tab Bar –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç**:
   - –ù—É–∂–µ–Ω padding-bottom –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–µ
   - –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –î–æ–±–∞–≤–∏—Ç—å Hamburger Menu
<MobileMoreMenu>
  <MenuItem href="/profile">–ü—Ä–æ—Ñ–∏–ª—å</MenuItem>
  <MenuItem href="/settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</MenuItem>
  <MenuItem href="/help">–ü–æ–º–æ—â—å</MenuItem>
</MobileMoreMenu>

// 2. Safe area padding
<div className="pb-[calc(var(--bottom-tab-bar-height)+env(safe-area-inset-bottom))]">
  {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
</div>
```

### 7.2 –§–æ—Ä–º–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `MusicGeneratorContent.tsx`

#### –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:

```tsx
<ScrollArea className={cn(
  'flex-grow',
  isMobile && 'max-h-[var(--generator-max-height-mobile)]'
)}>
```

**CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è**:
```css
--generator-max-height-mobile: calc(100vh - 180px);

@media (max-width: 767px) {
  --generator-max-height-mobile: calc(
    100vh
    - var(--workspace-header-height, 56px)
    - var(--bottom-tab-bar-height)
  );
}
```

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

1. **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
2. **–£–º–µ–Ω—å—à–µ–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã**:
   ```tsx
   padding: isMobile ? 'var(--spacing-card-padding)' : 'var(--space-2_5)'
   ```

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏**:
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–∏–∞–ª–æ–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Sheet –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **–°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π header –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞**:
   - –ó–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö
   - –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å collapse –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ

2. **–ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ –º–µ–ª–∫–∏–µ**:
   - –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç WCAG AAA (44px min)

3. **QuickActionsBar –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω**:
   - –ú–Ω–æ–≥–æ –∫–Ω–æ–ø–æ–∫ –≤ —Ä—è–¥
   - –ù–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. Collapsible Header
<CompactHeader
  mode={mode}
  collapsed={isScrolled && isMobile}
  // ...
/>

// 2. –ë–æ–ª—å—à–∏–µ touch targets
<ToggleGroup className="h-11 w-full"> {/* 44px */}
  <ToggleGroupItem className="flex-1">
    –ü—Ä–æ—Å—Ç–æ–π
  </ToggleGroupItem>
  <ToggleGroupItem className="flex-1">
    –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π
  </ToggleGroupItem>
</ToggleGroup>

// 3. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π QuickActionsBar
<QuickActionsBar
  direction={isMobile ? 'vertical' : 'horizontal'}
  compact={isMobile}
  // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
  hideInactive={isMobile}
/>
```

### 7.3 TrackCard –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–§–∞–π–ª**: `src/features/tracks/components/TrackCardMobile.tsx`

**–ü—Ä–æ–±–ª–µ–º–∞**: –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

#### ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **TrackCard –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω**:
   - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏–π (10+ –∫–Ω–æ–ø–æ–∫)
   - –ú–µ–ª–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - –ü–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏

2. **–û–±–ª–æ–∂–∫–∞ —Ç—Ä–µ–∫–∞**:
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π
   - –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç lazy loading

3. **–í–µ—Ä—Å–∏–∏ —Ç—Ä–µ–∫–æ–≤** (–µ—Å–ª–∏ –±—ã —Ä–∞–±–æ—Ç–∞–ª–æ):
   - Selector –≤–µ—Ä—Å–∏–π –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ touch

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TrackCardMobile –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
const TrackCardWrapper = ({ track, ...props }) => {
  const { isMobile } = useBreakpoints();

  return isMobile
    ? <TrackCardMobile track={track} {...props} />
    : <TrackCard track={track} {...props} />;
};

// 2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
<TrackCardMobile>
  <PrimaryActions>
    <PlayButton />
    <LikeButton />
    <ShareButton />
  </PrimaryActions>

  <MoreActionsMenu> {/* –û—Å—Ç–∞–ª—å–Ω–æ–µ –≤ –º–µ–Ω—é */}
    <MenuItem>–°–∫–∞—á–∞—Ç—å</MenuItem>
    <MenuItem>Extend</MenuItem>
    <MenuItem>Cover</MenuItem>
    {/* ... */}
  </MoreActionsMenu>
</TrackCardMobile>

// 3. Swipeable actions
<SwipeableCard
  onSwipeLeft={<LikeButton />}
  onSwipeRight={<DeleteButton />}
>
  <TrackContent />
</SwipeableCard>
```

### 7.4 Detail Panel –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–§–∞–π–ª**: `src/features/tracks/ui/DetailPanelMobile.tsx`

#### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```tsx
// Desktop
<ResizablePanel>
  <DetailPanelContent />
</ResizablePanel>

// Mobile
<Sheet side="bottom" open={open}>
  <DetailPanelContent />
</Sheet>
```

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **Sheet –≤—ã—Å–æ—Ç–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** (90vh):
   - –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ fullscreen

2. **Tabs –≤ Detail Panel**:
   - –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–æ—Ö–æ
   - –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Accordion

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ Sheet
<Sheet
  side="bottom"
  className={cn(
    keyboardVisible
      ? 'max-h-[50vh]'
      : 'max-h-[90vh]'
  )}
>

// 2. Accordion –≤–º–µ—Å—Ç–æ Tabs –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
{isMobile ? (
  <Accordion>
    <AccordionItem value="details">
      <AccordionTrigger>–î–µ—Ç–∞–ª–∏</AccordionTrigger>
      <AccordionContent>{/* ... */}</AccordionContent>
    </AccordionItem>
    <AccordionItem value="versions">
      <AccordionTrigger>–í–µ—Ä—Å–∏–∏</AccordionTrigger>
      <AccordionContent>{/* ... */}</AccordionContent>
    </AccordionItem>
  </Accordion>
) : (
  <Tabs>{/* ... */}</Tabs>
)}
```

### 7.5 Player –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `MiniPlayer.tsx` –∏ `FullScreenPlayer.tsx`

#### ‚úÖ –•–æ—Ä–æ—à–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

1. **MiniPlayer** –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞
2. **Fullscreen Player** –ø–æ –∫–ª–∏–∫—É
3. **Swipe down** –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è

#### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

1. **MiniPlayer –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç BottomTabBar**:
   - –ù—É–∂–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è z-index

2. **–ù–µ—Ç landscape —Ä–µ–∂–∏–º–∞**:
   - –ü—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ Player –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è

#### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

```tsx
// 1. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å Bottom Tab Bar
<MiniPlayer
  className={cn(
    'bottom-[var(--bottom-tab-bar-height)]',
    'z-[var(--z-mini-player)]'
  )}
/>

// 2. Landscape –∞–¥–∞–ø—Ç–∞—Ü–∏—è
const { isLandscape } = useOrientation();

<FullScreenPlayer
  layout={isLandscape ? 'horizontal' : 'vertical'}
>
  {isLandscape && (
    <div className="flex-row">
      <Cover className="w-1/3" />
      <Controls className="w-2/3" />
    </div>
  )}
</FullScreenPlayer>
```

---

## 8. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ)

#### 1. –ë–∞–≥ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤–µ—Ä—Å–∏–π —Ç—Ä–µ–∫–æ–≤

**–§–∞–π–ª**: `ARCHITECTURE.md:136`
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–∫–∞ –≤–º–µ—Å—Ç–æ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤—ã–±–∏—Ä–∞—Ç—å –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º—É–∑—ã–∫–∏

**–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è**:
- `src/hooks/useTrackVersions.ts`
- `src/features/tracks/components/TrackVersions.tsx`
- SQL –∑–∞–ø—Ä–æ—Å—ã –≤ `useTracks.ts`

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞**:
```typescript
// –í–æ–∑–º–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ primary variant:
.filter(version => version.is_primary_variant)

// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
.filter(version => version.audio_url !== null)
```

#### 2. –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è logger –∏–º–ø–æ—Ä—Ç—ã

**–°—Ç–∞—Ç—É—Å**: –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π**:
- ‚úÖ `PromptDJHelper.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- ‚úÖ `PromptDJ.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–∏—á–∏–Ω–∞**: Automated refactoring bot (commit 59d684b) –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–æ–±–∞–≤–∏–ª –∏–º–ø–æ—Ä—Ç—ã

**–î–µ–π—Å—Ç–≤–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:
```bash
# –ü–æ–∏—Å–∫ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∏–º–ø–æ—Ä—Ç–æ–≤
grep -r "import.*logger.*from.*logger" src/
```

#### 3. Node.js –≤–µ—Ä—Å–∏—è –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

**–¢–µ–∫—É—â–∞—è**: v18.19.1
**–¢—Ä–µ–±—É–µ—Ç—Å—è**: v20.19.0+
**–ü—Ä–∏—á–∏–Ω–∞**: Vite 7.1.12 –∏ Vitest 4.0.6 —Ç—Ä–µ–±—É—é—Ç Node 20+

**–î–µ–π—Å—Ç–≤–∏–µ**:
- –û–±–Ω–æ–≤–∏—Ç—å Node.js –¥–æ v20+
- –ò–ª–∏ –ø–æ–Ω–∏–∑–∏—Ç—å Vite/Vitest –¥–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π

### ‚ö†Ô∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P1 (–í—ã—Å–æ–∫–∏–π)

#### 4. –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ URL

**–ü—Ä–æ–±–ª–µ–º–∞**: Signed URLs –æ—Ç Supabase –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 1 —á–∞—Å
**–í–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ**: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞ —á–µ—Ä–µ–∑ —á–∞—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// 1. –°–æ—Ö—Ä–∞–Ω—è—Ç—å storage path –≤–º–µ—Å—Ç–æ signed URL
interface ReferenceAudio {
  storage_path: string; // 'audio/user123/file.mp3'
  signed_url?: string;  // –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ
  expires_at?: Date;
}

// 2. –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è URL –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
const getValidReferenceUrl = async (path: string) => {
  const { data, error } = await supabase.storage
    .from('audio')
    .createSignedUrl(path, 3600); // 1 —á–∞—Å

  return data.signedUrl;
};
```

#### 5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ Suno API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ Mureka

```typescript
const generateWithFallback = async (params) => {
  try {
    return await ProviderFactory.getProvider('suno').generateMusic(params);
  } catch (error) {
    if (error.status === 503) { // Service Unavailable
      logger.warn('Suno unavailable, falling back to Mureka');

      // –£–¥–∞–ª–∏—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      const murekaParams = {
        ...params,
        referenceAudioUrl: null,
        personaId: null
      };

      return await ProviderFactory.getProvider('mureka').generateMusic(murekaParams);
    }
    throw error;
  }
};
```

#### 6. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ñ–æ—Ä–º–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ**: –°–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 3.3.3

### üìã –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P2 (–°—Ä–µ–¥–Ω–∏–π)

#### 7. –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ Replicate

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ = –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –∫—Ä–µ–¥–∏—Ç–æ–≤
**–†–µ—à–µ–Ω–∏–µ**: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ hash —Ñ–∞–π–ª–∞ –≤ –ë–î

#### 8. TrackCard –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TrackCardMobile` —Å —É–ø—Ä–æ—â–µ–Ω–Ω—ã–º UI

#### 9. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

**–†–µ—à–µ–Ω–∏–µ**: –°–º. —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ 3.2

#### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º—ã

**–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å theme switcher + CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è light mode

---

## 9. –ü–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### üìÖ –§–∞–∑–∞ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤ (1-2 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è logger –∏–º–ø–æ—Ä—Ç—ã**
   - [x] PromptDJHelper.ts
   - [x] PromptDJ.tsx
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

2. üî¥ **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ —Å –≤–µ—Ä—Å–∏—è–º–∏ —Ç—Ä–µ–∫–æ–≤**
   - [ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å `useTrackVersions.ts`
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
   - [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
   - [ ] –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π

3. ‚ö†Ô∏è **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ URL —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤**
   - [ ] –°–æ—Ö—Ä–∞–Ω—è—Ç—å storage path
   - [ ] –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å URL –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É –ë–î

4. ‚ö†Ô∏è **Node.js –≤–µ—Ä—Å–∏—è**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ v20+ –∏–ª–∏
   - [ ] –ü–æ–Ω–∏–∑–∏—Ç—å Vite/Vitest

### üìÖ –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ UI/UX –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ (3-5 –¥–Ω–µ–π)

**–ó–∞–¥–∞—á–∏:**

1. **–£–ª—É—á—à–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ü–∏—é —Ä–µ–∂–∏–º–æ–≤**
   - [ ] ToggleGroup —Å –∏–∫–æ–Ω–∫–∞–º–∏
   - [ ] Tooltips —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
   - [ ] –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

2. **–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –≤—ã–±–æ—Ä–µ**
   - [ ] –ü–µ—Ä—Å–æ–Ω–∞ ‚Üí preview + –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ prompt
   - [ ] –ü—Ä–æ–µ–∫—Ç ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤, prompt
   - [ ] –†–µ—Ñ–µ—Ä–µ–Ω—Å ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ storage path
   - [ ] –¢—Ä–µ–∫ ‚Üí smart –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞**
   - [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã:
     - GenerationParamsContext
     - UIStateContext
     - EnhancedPromptContext
   - [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å MusicGeneratorContainer

4. **–£–ª—É—á—à–∏—Ç—å QuickActionsBar**
   - [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π layout (vertical –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)
   - [ ] –°–∫—Ä—ã–≤–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å preview –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### üìÖ –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**
   - [ ] Health check –¥–ª—è Suno/Mureka
   - [ ] –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **Capabilities —Å–∏—Å—Ç–µ–º–∞**
   - [ ] –î–æ–±–∞–≤–∏—Ç—å capabilities –≤ IProviderClient
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å badges –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
   - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

3. **Replicate –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
   - [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ hash
   - [ ] Retry –ª–æ–≥–∏–∫–∞
   - [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (Essentia.js)

4. **Real-time –±–∞–ª–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤**
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫—Ä–µ–¥–∏—Ç—ã
   - [ ] –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ

### üìÖ –§–∞–∑–∞ 4: –õ–µ–Ω—Ç–∞ —Ç—Ä–µ–∫–æ–≤ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

1. **Infinite scroll –¥–ª—è —Ç—Ä–µ–∫–æ–≤**
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å useInfiniteQuery
   - [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å loader –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - [ ] End of list –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä

2. **TrackCard –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è**
   - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TrackCardMobile –Ω–∞ < md
   - [ ] –£–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è (—Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω—ã–µ + menu)
   - [ ] Swipeable actions (like/delete)
   - [ ] –£–≤–µ–ª–∏—á–∏—Ç—å tap targets (44px+)

3. **Track Operations —É–ª—É—á—à–µ–Ω–∏—è**
   - [ ] Soft delete —Å –∫–æ—Ä–∑–∏–Ω–æ–π
   - [ ] Undo –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
   - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
   - [ ] Progress –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

4. **–í–µ—Ä—Å–∏–∏ —Ç—Ä–µ–∫–æ–≤ UI**
   - [ ] Selector –≤–µ—Ä—Å–∏–π –≤ TrackCard
   - [ ] Version comparison view
   - [ ] Set as master version

### üìÖ –§–∞–∑–∞ 5: –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ –∏ —Ç–µ–º–∏–∑–∞—Ü–∏—è (3-4 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

1. **–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞**
   - [ ] CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è light mode
   - [ ] Theme switcher –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
   - [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –≤ localStorage
   - [ ] Sync —Å system preference

2. **–ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ semantic tokens**
   - [ ] –°–æ–∑–¥–∞—Ç—å semantic tokens –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ tokens
   - [ ] –£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ –∑–Ω–∞—á–µ–Ω–∏–π

3. **–ö–æ–Ω—Å–æ–ª–∏–¥–∞—Ü–∏—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
   - [ ] –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è (loading, skeleton)
   - [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ–±–µ—Ä—Ç–∫–∏ (ResponsiveDialog)
   - [ ] Mobile-friendly –≤–∞—Ä–∏–∞–Ω—Ç—ã (BottomSheet, SwipeableDrawer)

4. **Accessibility –∞—É–¥–∏—Ç**
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WCAG AA compliance
   - [ ] Touch targets 44px+
   - [ ] Keyboard navigation
   - [ ] Screen reader support

### üìÖ –§–∞–∑–∞ 6: –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (3-5 –¥–Ω–µ–π)

**–ó–∞–¥–∞—á–∏:**

1. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**
   - [ ] Hamburger menu –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
   - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ BottomTabBar —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
   - [ ] Safe area padding

2. **–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–æ—Ä–º–∞**
   - [ ] Collapsible header –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
   - [ ] –ë–æ–ª—å—à–∏–µ touch targets (—Ä–µ–∂–∏–º—ã: 44px+)
   - [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π QuickActionsBar (vertical)
   - [ ] Keyboard handling (—Å–¥–≤–∏–≥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)

3. **Detail Panel**
   - [ ] –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ Sheet
   - [ ] Fullscreen expand –æ–ø—Ü–∏—è
   - [ ] Accordion –≤–º–µ—Å—Ç–æ Tabs –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
   - [ ] Swipe to close

4. **Player**
   - [ ] –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è z-index —Å BottomTabBar
   - [ ] Landscape —Ä–µ–∂–∏–º
   - [ ] Swipe gestures (prev/next)

5. **Performance**
   - [ ] Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - [ ] Code splitting –ø–æ —Ä–æ—É—Ç–∞–º
   - [ ] Prefetch –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
   - [ ] PWA manifest –∏ service worker

### üìÖ –§–∞–∑–∞ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (2-3 –¥–Ω—è)

**–ó–∞–¥–∞—á–∏:**

1. **Unit —Ç–µ—Å—Ç—ã**
   - [ ] –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ö—É–∫–∏ (useTracks, useGenerateMusic)
   - [ ] Provider adapters
   - [ ] –£—Ç–∏–ª–∏—Ç—ã (logger, rate limiter)

2. **Integration —Ç–µ—Å—Ç—ã**
   - [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏ flow
   - [ ] Track operations
   - [ ] Realtime updates

3. **E2E —Ç–µ—Å—Ç—ã**
   - [ ] Complete generation flow
   - [ ] Mobile navigation
   - [ ] Player functionality

4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å ARCHITECTURE.md
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å MOBILE_OPTIMIZATION.md
   - [ ] –°–æ–∑–¥–∞—Ç—å DESIGN_SYSTEM.md
   - [ ] UI Component Storybook

---

## 10. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 10.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –Ω–∞ —Å–ª–æ–∏**:
   ```
   Presentation Layer (UI)
   ‚îú‚îÄ‚îÄ Components (React)
   ‚îú‚îÄ‚îÄ Hooks (Custom)
   ‚îî‚îÄ‚îÄ Stores (Zustand)

   Business Logic Layer
   ‚îú‚îÄ‚îÄ Services
   ‚îú‚îÄ‚îÄ Repositories
   ‚îî‚îÄ‚îÄ Domain Models

   Infrastructure Layer
   ‚îú‚îÄ‚îÄ API Clients (Supabase, Suno, Mureka)
   ‚îú‚îÄ‚îÄ Cache (IndexedDB)
   ‚îî‚îÄ‚îÄ Logger (Sentry)
   ```

2. **Feature-based —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**:
   ```
   src/features/
   ‚îú‚îÄ‚îÄ generation/
   ‚îÇ   ‚îú‚îÄ‚îÄ components/
   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
   ‚îÇ   ‚îú‚îÄ‚îÄ services/
   ‚îÇ   ‚îî‚îÄ‚îÄ types/
   ‚îú‚îÄ‚îÄ tracks/
   ‚îÇ   ‚îú‚îÄ‚îÄ components/
   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
   ‚îÇ   ‚îî‚îÄ‚îÄ types/
   ‚îî‚îÄ‚îÄ player/
       ‚îú‚îÄ‚îÄ components/
       ‚îú‚îÄ‚îÄ hooks/
       ‚îú‚îÄ‚îÄ store/
       ‚îî‚îÄ‚îÄ types/
   ```

3. **Dependency Injection**:
   ```typescript
   // –í–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
   import { supabase } from '@/integrations/supabase/client';

   // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DI
   interface TrackRepository {
     findById(id: string): Promise<Track>;
     // ...
   }

   class SupabaseTrackRepository implements TrackRepository {
     constructor(private client: SupabaseClient) {}
     // ...
   }
   ```

### 10.2 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **Bundle size optimization**:
   - Code splitting –ø–æ —Ä–æ—É—Ç–∞–º
   - Dynamic imports –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
   - Tree shaking –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞

2. **React –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
   - –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (React.memo)
   - useMemo –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
   - useCallback –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–æ–∫
   - –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤

3. **Network –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
   - Prefetch –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Optimistic updates
   - Background sync –¥–ª—è offline
   - Image lazy loading

### 10.3 Developer Experience

1. **TypeScript strict mode**:
   - –£–∂–µ –≤–∫–ª—é—á–µ–Ω ‚úÖ
   - –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏–∑–±–µ–≥–∞—Ç—å `any`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å discriminated unions

2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ `logger` ‚úÖ
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - Context tags –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
   - –ú–∏–Ω–∏–º—É–º 70% coverage –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–ª–æ—É
   - Visual regression tests

4. **CI/CD**:
   - Pre-commit hooks (lint, typecheck)
   - Automated tests –≤ PR
   - Automated deployment –Ω–∞ —É—Å–ø–µ—à–Ω—ã–π merge

### 10.4 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Row Level Security** (—É–∂–µ –≤–∫–ª—é—á–µ–Ω ‚úÖ):
   - –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å RLS
   - –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç policies

2. **Rate Limiting**:
   - –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω ‚úÖ
   - –î–æ–±–∞–≤–∏—Ç—å per-user –ª–∏–º–∏—Ç—ã
   - IP-based throttling

3. **Input validation**:
   - Zod schemas –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - Sanitization user inputs
   - XSS prevention

4. **Secrets management**:
   - Supabase Vault –¥–ª—è —Å–µ–∫—Ä–µ—Ç–æ–≤
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å API keys
   - Rotate keys —Ä–µ–≥—É–ª—è—Ä–Ω–æ

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ**:
- 100+ —Ñ–∞–π–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
- 60+ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- 50+ custom hooks
- 3 AI provider –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- 10+ Edge Functions

**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º**:
- üî¥ P0 (–ö—Ä–∏—Ç–∏—á–Ω–æ): 3
- ‚ö†Ô∏è P1 (–í—ã—Å–æ–∫–∏–π): 4
- üìã P2 (–°—Ä–µ–¥–Ω–∏–π): 6

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**:
- –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏: 1-2 –¥–Ω—è
- UI/UX –¥–æ—Ä–∞–±–æ—Ç–∫–∏: 3-5 –¥–Ω–µ–π
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: 2-3 –¥–Ω—è
- –õ–µ–Ω—Ç–∞ —Ç—Ä–µ–∫–æ–≤: 2-3 –¥–Ω—è
- –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞: 3-4 –¥–Ω—è
- –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: 3-5 –¥–Ω–µ–π
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: 2-3 –¥–Ω—è

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: 16-25 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (3-5 –Ω–µ–¥–µ–ª—å)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏** (P0)
2. **–°–æ–∑–¥–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏** –≤ issue tracker
3. **–ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö** –∑–∞ –∫–∞–∂–¥—É—é —Ñ–∞–∑—É
4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã** –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã
5. **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–µ–≤—å—é** –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é)

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

