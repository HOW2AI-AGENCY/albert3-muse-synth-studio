# üéöÔ∏è –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç–µ–º—ã

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∞—É–¥–∏–æ –Ω–∞ —Å—Ç–µ–º—ã (stems) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ –≥–æ—Ç–æ–≤–æ–≥–æ —Ç—Ä–µ–∫–∞, —Ç–∞–∫–∏–µ –∫–∞–∫ –≤–æ–∫–∞–ª, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—ã, —É–¥–∞—Ä–Ω—ã–µ –∏ –¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –†–µ–∂–∏–º—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

#### 1. –ë–∞–∑–æ–≤–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (2 —Å—Ç–µ–º–∞)
**–†–µ–∂–∏–º**: `separate_vocal`

–†–∞–∑–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–∫ –Ω–∞:
- üé§ **–í–æ–∫–∞–ª** - –≤—Å–µ –≤–æ–∫–∞–ª—å–Ω—ã–µ –ø–∞—Ä—Ç–∏–∏
- üéπ **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª** - –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –±–µ–∑ –≤–æ–∫–∞–ª–∞

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
- –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–Ω—É—Å–æ–≤–æ–∫
- –†–µ–º–∏–∫—Å—ã
- –ö–∞—Ä–∞–æ–∫–µ –≤–µ—Ä—Å–∏–∏
- –ó–∞–º–µ–Ω–∞ –≤–æ–∫–∞–ª–∞

#### 2. –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (–¥–æ 8 —Å—Ç–µ–º–æ–≤)
**–†–µ–∂–∏–º**: `split_stem`

–†–∞–∑–¥–µ–ª—è–µ—Ç —Ç—Ä–µ–∫ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- ü•Å **Drums** (–£–¥–∞—Ä–Ω—ã–µ)
- üé∏ **Bass** (–ë–∞—Å)
- üé∏ **Guitar** (–ì–∏—Ç–∞—Ä–∞)
- üéπ **Keyboard** (–ö–ª–∞–≤–∏—à–Ω—ã–µ)
- üéª **Strings** (–°—Ç—Ä—É–Ω–Ω—ã–µ)
- üé∫ **Brass** (–î—É—Ö–æ–≤—ã–µ –º–µ–¥–Ω—ã–µ)
- üé∑ **Woodwinds** (–î—É—Ö–æ–≤—ã–µ –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–µ)
- üéõÔ∏è **Synth** (–°–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä)
- üîä **Percussion** (–ü–µ—Ä–∫—É—Å—Å–∏—è)
- ‚ú® **FX** (–≠—Ñ—Ñ–µ–∫—Ç—ã)

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–º–∞—Å—Ç–µ—Ä–∏–Ω–≥
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–∏–∫—Å—ã
- –°—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—É—á–µ–Ω–∏–µ –º—É–∑—ã–∫–µ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
sequenceDiagram
    participant User
    participant UI as TrackStemsPanel
    participant Edge as separate-stems Function
    participant External as Replicate API
    participant Callback as stems-callback Function
    participant DB as Supabase Database

    User->>UI: –ù–∞–∂–∏–º–∞–µ—Ç "–°–æ–∑–¥–∞—Ç—å —Å—Ç–µ–º—ã"
    UI->>Edge: POST —Å trackId –∏ —Ä–µ–∂–∏–º–æ–º
    Edge->>External: –ó–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
    External-->>Edge: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç task_id
    Edge->>DB: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç task_id
    Edge-->>UI: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç success

    Note over UI: –ù–∞—á–∏–Ω–∞–µ—Ç polling (–∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
    
    External->>Callback: Webhook –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    Callback->>DB: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç URLs —Å—Ç–µ–º–æ–≤
    
    UI->>DB: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—Ç–µ–º–æ–≤
    DB-->>UI: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–µ–º—ã
    UI->>User: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç–µ–º—ã
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `track_stems`

```sql
CREATE TABLE track_stems (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  track_id UUID NOT NULL REFERENCES tracks(id) ON DELETE CASCADE,
  version_id UUID REFERENCES track_versions(id) ON DELETE CASCADE,
  stem_type TEXT NOT NULL, -- 'vocals', 'instrumental', 'drums', etc.
  audio_url TEXT NOT NULL,
  separation_mode TEXT NOT NULL, -- 'separate_vocal' –∏–ª–∏ 'split_stem'
  suno_task_id TEXT, -- ID –∑–∞–¥–∞—á–∏ –≤ Replicate
  metadata JSONB DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### –ò–Ω–¥–µ–∫—Å—ã
```sql
CREATE INDEX idx_track_stems_track_id ON track_stems(track_id);
CREATE INDEX idx_track_stems_version_id ON track_stems(version_id);
CREATE INDEX idx_track_stems_mode ON track_stems(separation_mode);
```

### RLS Policies
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–µ–º—ã —Å–≤–æ–∏—Ö —Ç—Ä–µ–∫–æ–≤
CREATE POLICY "Users can view stems of their own tracks"
  ON track_stems FOR SELECT
  USING (EXISTS (
    SELECT 1 FROM tracks
    WHERE tracks.id = track_stems.track_id
    AND tracks.user_id = auth.uid()
  ));

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–µ–º—ã –ø—É–±–ª–∏—á–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
CREATE POLICY "Users can view stems of public tracks"
  ON track_stems FOR SELECT
  USING (EXISTS (
    SELECT 1 FROM tracks
    WHERE tracks.id = track_stems.track_id
    AND tracks.is_public = true
  ));
```

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### TrackStemsPanel

**–ü—É—Ç—å**: `src/components/tracks/TrackStemsPanel.tsx`

#### –ü—Ä–æ–ø—Å—ã
```typescript
interface TrackStemsPanelProps {
  trackId: string;          // ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ç—Ä–µ–∫–∞
  versionId?: string;       // ID –≤–µ—Ä—Å–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  stems: TrackStem[];       // –ú–∞—Å—Å–∏–≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–µ–º–æ–≤
  onStemsGenerated?: () => void; // Callback –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
}
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

##### 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–µ–º–æ–≤
```typescript
const handleGenerateStems = async (
  mode: 'separate_vocal' | 'split_stem'
) => {
  // –í—ã–∑–æ–≤ Edge Function
  const { data, error } = await supabase.functions.invoke('separate-stems', {
    body: { trackId, versionId, separationMode: mode }
  });

  // –ó–∞–ø—É—Å–∫ polling –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
  const pollInterval = setInterval(async () => {
    const { data: stemsData } = await supabase
      .from('track_stems')
      .select('*')
      .eq('track_id', trackId);
    
    if (stemsData && stemsData.length > 0) {
      clearInterval(pollInterval);
      onStemsGenerated?.();
    }
  }, 5000);
};
```

##### 2. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å—Ç–µ–º–∞
```typescript
const handlePlayStem = (stem: TrackStem) => {
  const stemKey = `stem-${stem.id}`;
  const isCurrentStem = currentTrack?.id === stemKey;

  if (isCurrentStem && isPlaying) {
    togglePlayPause();
  } else {
    playTrack({
      id: stemKey,
      title: stemTypeLabels[stem.stem_type],
      audio_url: stem.audio_url,
    });
  }
};
```

##### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–º–∞
```typescript
const handleDownloadStem = (stem: TrackStem) => {
  window.open(stem.audio_url, '_blank');
};
```

#### UI —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```tsx
{stems.length === 0 ? (
  // –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
  <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
    <Button onClick={() => handleGenerateStems('separate_vocal')}>
      –í–æ–∫–∞–ª + –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª
    </Button>
    <Button onClick={() => handleGenerateStems('split_stem')}>
      –ü–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º
    </Button>
  </div>
) : (
  // –°–ø–∏—Å–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–µ–º–æ–≤
  <div className="space-y-2">
    {stems.map(stem => (
      <div key={stem.id} className="flex items-center gap-3">
        <Button onClick={() => handlePlayStem(stem)}>
          {isPlaying ? <Pause /> : <Play />}
        </Button>
        <span>{stemTypeLabels[stem.stem_type]}</span>
        <Button onClick={() => handleDownloadStem(stem)}>
          <Download />
        </Button>
      </div>
    ))}
  </div>
)}
```

## üîå API

### Edge Function: `separate-stems`

**–ü—É—Ç—å**: `supabase/functions/separate-stems/index.ts`

**Endpoint**: `POST https://api.sunoapi.org/api/v1/vocal-removal/generate`

#### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```typescript
interface SeparateStemsRequest {
  trackId: string;
  versionId?: string;
  separationMode: 'separate_vocal' | 'split_stem';
}
```

#### –ü—Ä–æ—Ü–µ—Å—Å
1. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ URL —Ç—Ä–µ–∫–∞
3. –í—ã–∑–æ–≤ Suno API –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ task_id –≤ –ë–î
5. –í–æ–∑–≤—Ä–∞—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

#### –ö–æ–¥—ã –æ—à–∏–±–æ–∫
- **200**: Success - Stem separation completed
- **400**: Bad Request - Parameter error or unsupported audio format
- **451**: Download Failed - Unable to download source audio file
- **500**: Server Error - Please try again later

#### –ü—Ä–∏–º–µ—Ä
```typescript
const response = await supabase.functions.invoke('separate-stems', {
  body: {
    trackId: 'uuid-here',
    separationMode: 'separate_vocal'
  }
});
```

### Callback Function: `stems-callback`

**–ü—É—Ç—å**: `supabase/functions/stems-callback/index.ts`

#### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–æ–ª—É—á–∞–µ—Ç webhook –æ—Ç Replicate API –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.

#### –ü—Ä–æ—Ü–µ—Å—Å
1. –ü–æ–ª—É—á–∞–µ—Ç URLs —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–µ–º–æ–≤
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π —Å—Ç–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É `track_stems`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–ª–∞–≥ `has_stems = true` —É —Ç—Ä–µ–∫–∞
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

## üé® –î–∏–∑–∞–π–Ω

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å—Ç–µ–º–æ–≤

```typescript
const stemColors = {
  vocals: 'bg-purple-500',
  instrumental: 'bg-blue-500',
  drums: 'bg-red-500',
  bass: 'bg-orange-500',
  guitar: 'bg-yellow-500',
  keyboard: 'bg-green-500',
  strings: 'bg-teal-500',
  brass: 'bg-amber-500',
  synth: 'bg-pink-500',
  fx: 'bg-indigo-500',
};
```

### –ò–∫–æ–Ω–∫–∏
- üé§ Vocals
- üéπ Instrumental
- ü•Å Drums
- üé∏ Bass/Guitar
- üéπ Keyboard
- üéª Strings
- üé∫ Brass
- üéõÔ∏è Synth
- ‚ú® FX

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –í DetailPanel

```typescript
<TrackStemsPanel
  trackId={track.id}
  stems={stems}
  onStemsGenerated={loadVersionsAndStems}
/>
```

### 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ Accordion

```typescript
<AccordionItem value="stems">
  <AccordionTrigger>
    –°—Ç–µ–º—ã {stems.length > 0 && `(${stems.length})`}
  </AccordionTrigger>
  <AccordionContent>
    <TrackStemsPanel {...props} />
  </AccordionContent>
</AccordionItem>
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Lazy loading**: –°—Ç–µ–º—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–µ–∫—Ü–∏–∏
- **Polling timeout**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
- **–ú–µ–º–æ–∏–∑–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `useMemo` –∏ `useCallback`

### –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ë–∞–∑–æ–≤–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (separate_vocal)**: 30-90 —Å–µ–∫—É–Ω–¥
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (split_stem)**: 60-180 —Å–µ–∫—É–Ω–¥

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–º
const { data: track } = await supabase
  .from('tracks')
  .select('user_id')
  .eq('id', trackId)
  .single();

if (track.user_id !== user.id) {
  throw new Error('Unauthorized');
}
```

### RLS Policies
- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–µ–º—ã
- –ü—É–±–ª–∏—á–Ω—ã–µ —Ç—Ä–µ–∫–∏: —Å—Ç–µ–º—ã –≤–∏–¥–Ω—ã –≤—Å–µ–º
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ç—Ä–µ–∫–∏: —Å—Ç–µ–º—ã –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É

## üêõ Troubleshooting

### –°—Ç–µ–º—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã**:
1. –°—Ç–µ–º—ã –µ—â–µ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
2. –û—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
3. Webhook –Ω–µ –±—ã–ª –ø–æ–ª—É—á–µ–Ω

**–†–µ—à–µ–Ω–∏–µ**:
```typescript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Å—Ç–µ–º–æ–≤ –≤ –ë–î
const { data } = await supabase
  .from('track_stems')
  .select('*')
  .eq('track_id', trackId);

console.log('Stems:', data);
```

### Polling –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: –°—Ç–µ–º—ã –Ω–µ –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Edge Function (`stems-callback`)
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ callback URL –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Suno API –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –æ—à–∏–±–∫–∏ –≤ metadata —Ç—Ä–µ–∫–∞:
  - 400: Parameter error or unsupported format
  - 451: Failed to download source audio
  - 500: Suno server error

### –û—à–∏–±–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å—Ç–µ–º–æ–≤

#### 400 - Parameter Error
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

**–†–µ—à–µ–Ω–∏–µ**:
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç—Ä–µ–∫ –±—ã–ª —Å–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ Suno API
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `taskId` –∏ `audioId` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ä–µ–∂–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

#### 451 - Download Failed
**–ü—Ä–∏—á–∏–Ω–∞**: Suno –Ω–µ —Å–º–æ–≥ —Å–∫–∞—á–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∞—É–¥–∏–æ —Ñ–∞–π–ª

**–†–µ—à–µ–Ω–∏–µ**:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å audio_url
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–∫
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

#### 500 - Server Error
**–ü—Ä–∏—á–∏–Ω–∞**: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ Suno API

**–†–µ—à–µ–Ω–∏–µ**:
- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–Ω–æ–≤–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å Suno API

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–µ–∂–∏–º—ã

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
```typescript
// –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
await supabase
  .from('analytics_events')
  .insert({
    event_type: 'stems_generated',
    track_id: trackId,
    metadata: {
      mode: separationMode,
      duration: processingTime,
    }
  });
```

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–µ–º–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- [ ] Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–µ–∫–æ–≤
- [ ] –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è
- [ ] –í–∏–∑—É–∞–ª—å–Ω—ã–µ –≤–æ–ª–Ω–æ–≤—ã–µ —Ñ–æ—Ä–º—ã –¥–ª—è —Å—Ç–µ–º–æ–≤
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö (WAV, FLAC)
- [ ] AI-powered —É–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ —Å—Ç–µ–º–æ–≤
- [ ] –°—Ä–∞–≤–Ω–µ–Ω–∏–µ "–¥–æ/–ø–æ—Å–ª–µ" —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è

---

**–í–µ—Ä—Å–∏—è**: 1.5.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ø–Ω–≤–∞—Ä—å 2025  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Production Ready
