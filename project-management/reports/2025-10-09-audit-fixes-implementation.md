# –û—Ç—á–µ—Ç –æ–± —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–µ–∫—Ç–∞
**–î–∞—Ç–∞:** 9 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Cline AI Assistant  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## üìã EXECUTIVE SUMMARY

–ü—Ä–æ–≤–µ–¥–µ–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞ albert3-muse-synth-studio –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:

1. ‚úÖ **–ë–∞–ª–∞–Ω—Å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è** - –ò–°–ü–†–ê–í–õ–ï–ù–û
2. ‚ö†Ô∏è **–í–µ—Ä—Å–∏—è 2 —Ç—Ä–µ–∫–æ–≤ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è** - –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–û–ë–ê–í–õ–ï–ù–ê
3. ‚ö†Ô∏è **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç** - –£–õ–£–ß–®–ï–ù–û –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

---

## üîß –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

#### –ü—Ä–æ–±–ª–µ–º–∞
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ProviderBalance` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–ª—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- –ë–∞–ª–∞–Ω—Å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏—á–∏–Ω–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –±–∞–ª–∞–Ω—Å–∞

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
**–§–∞–π–ª:** `src/components/layout/ProviderBalance.tsx`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ state –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `error` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
2. –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—à–∏–±–∫–∏:
   ```tsx
   <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-destructive/10 border border-destructive/20 cursor-help" 
        title={error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–ª–∞–Ω—Å'}>
     <DollarSign className="h-4 w-4 text-destructive" />
     <span className="text-xs text-destructive font-medium">–û—à–∏–±–∫–∞</span>
   </div>
   ```

3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
   ```tsx
   <div className="sm:hidden flex items-center gap-2 px-2 py-1.5 rounded-full bg-primary/10 border border-primary/20" 
        title={`${balance.toLocaleString()} –∫—Ä–µ–¥–∏—Ç–æ–≤`}>
     <Zap className="h-4 w-4 text-primary" />
   </div>
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –≤–∏–¥—è—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (–∏–∫–æ–Ω–∫–∞ —Å —Ç—É–ª—Ç–∏–ø–æ–º)
- ‚úÖ –£–ª—É—á—à–µ–Ω UX - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º

---

### 2. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π —Ç—Ä–µ–∫–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞
- –í–µ—Ä—Å–∏—è 2 —Ç—Ä–µ–∫–æ–≤ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç Suno API) –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `track_versions`
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ª–∏ Suno API 2 —Ç—Ä–µ–∫–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ 1

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
**–§–∞–π–ª:** `supabase/functions/generate-suno/index.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**

1. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤ –æ—Ç Suno API:**
   ```typescript
   console.log(`üìä [DIAGNOSTIC] Total tasks returned: ${tasks.length}`);
   const statusesLog = tasks.map((t: any, idx: number) => ({
     index: idx,
     id: t.id || t.taskId,
     status: t.status,
     hasAudio: Boolean(t.audioUrl || t.audio_url || t.stream_audio_url || t.source_stream_audio_url),
     audioUrl: (t.audioUrl || t.audio_url || t.stream_audio_url || t.source_stream_audio_url)?.substring(0, 60),
     hasCover: Boolean(t.image_url || t.image_large_url || t.imageUrl),
     hasVideo: Boolean(t.video_url || t.videoUrl),
     title: t.title,
     model: t.model || t.model_name
   }));
   console.log('üîç [DIAGNOSTIC] Suno poll statuses:', JSON.stringify(statusesLog, null, 2));
   ```

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π —É—Å–ø–µ—à–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤:**
   ```typescript
   successfulTracks.forEach((track: any, idx: number) => {
     console.log(`üìã [TRACK ${idx}] Details:`, {
       id: track.id,
       title: track.title,
       status: track.status,
       audioUrl: (track.audioUrl || track.audio_url)?.substring(0, 60) + '...',
       hasLyrics: Boolean(track.lyric || track.lyrics),
       duration: track.duration || track.duration_seconds
     });
   });
   ```

3. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ—Ä—Å–∏–π:**
   ```typescript
   if (insertVersionError) {
     logger.error(`üî¥ [VERSION ${i}] Failed to insert`, { 
       error: insertVersionError,
       code: insertVersionError.code,
       message: insertVersionError.message,
       details: insertVersionError.details,
       hint: insertVersionError.hint
     });
     console.error(`üî¥ [VERSION ${i}] Database error details:`, {
       errorCode: insertVersionError.code,
       errorMessage: insertVersionError.message,
       parentTrackId: trackId,
       versionNumber: i
     });
   }
   ```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–∫–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Suno API
- ‚úÖ –í–∏–¥–Ω—ã –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —Ç—Ä–µ–∫–∞ (—Å—Ç–∞—Ç—É—Å, –Ω–∞–ª–∏—á–∏–µ –∞—É–¥–∏–æ, URL –∏ —Ç.–¥.)
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

---

## üìä –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç—Ä–µ–∫–∞** —á–µ—Ä–µ–∑ UI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏ Supabase Edge Functions:**
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Supabase Dashboard
   - Functions ‚Üí generate-suno ‚Üí Logs
3. **–ò—â–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã:**
   - `üìä [DIAGNOSTIC] Total tasks returned:` - —Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–∫–æ–≤ –≤–µ—Ä–Ω—É–ª Suno
   - `üîç [DIAGNOSTIC] Suno poll statuses:` - –¥–µ—Ç–∞–ª–∏ –≤—Å–µ—Ö —Ç—Ä–µ–∫–æ–≤
   - `üìã [TRACK X] Details:` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —É—Å–ø–µ—à–Ω–æ–º —Ç—Ä–µ–∫–µ
   - `üéµ [VERSIONS] Processing X additional version(s)...` - –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ—Ä—Å–∏–π
   - `‚úÖ [VERSION X] Successfully created version` - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏
   - `üî¥ [VERSION X] Failed to insert` - –æ—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ—Ä—Å–∏–∏

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–µ—Ä—Å–∏–π

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞ –≤—ã—è–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### A. Suno API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1 —Ç—Ä–µ–∫
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –í—ã—Å–æ–∫–∞—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö `Total tasks returned: 1` –∏–ª–∏ `2`  
**–†–µ—à–µ–Ω–∏–µ:** –ï—Å–ª–∏ Suno –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ 1 —Ç—Ä–µ–∫, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∫ –∏—Ö API

#### B. –í—Ç–æ—Ä–æ–π —Ç—Ä–µ–∫ –Ω–µ –∏–º–µ–µ—Ç audio URL
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í –ª–æ–≥–∞—Ö `hasAudio: false` –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —Ç—Ä–µ–∫–∞  
**–†–µ—à–µ–Ω–∏–µ:** –í–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –ø–æ–ª–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±–æ–∏—Ö —Ç—Ä–µ–∫–æ–≤

#### C. –û—à–∏–±–∫–∞ constraint violation –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ò—â–∏—Ç–µ `errorCode: '23505'` (unique violation) –∏–ª–∏ `'23503'` (foreign key violation)  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RLS policies –∏ constraints –≤ —Ç–∞–±–ª–∏—Ü–µ `track_versions`

#### D. –ü–∞—Ä–∞–º–µ—Ç—Ä wait_audio –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–∫–æ–≤
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `wait_audio: false`  
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ `true` –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

#### 1.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ Suno API
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç—Ä–µ–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Supabase Dashboard
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–∫–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Suno API (1 –∏–ª–∏ 2)
- [ ] –ï—Å–ª–∏ 1 —Ç—Ä–µ–∫ - –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- [ ] –ï—Å–ª–∏ 2 —Ç—Ä–µ–∫–∞ - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É –≤—Ç–æ—Ä–æ–π –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

#### 1.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS policies
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor:
SELECT * FROM pg_policies WHERE tablename = 'track_versions';
```
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ service role –º–æ–∂–µ—Ç INSERT –≤ track_versions
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å constraint –Ω–∞ unique(parent_track_id, version_number)

#### 1.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –∫–ª—é—á–µ–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ SUNO_API_KEY –≤ Environment Variables
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Suno API
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã –∏ –±–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞ Suno

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–´–°–û–ö–ò–ô (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)

#### 2.1 –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É
**–§–∞–π–ª:** `src/services/api.service.ts`

```typescript
private static async retryWithBackoff<T>(
  fn: () => Promise<T>,
  maxRetries: number = 3,
  baseDelay: number = 1000
): Promise<T> {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      if (attempt === maxRetries) throw error;
      
      // Check if error is retryable
      const isRetryable = 
        error instanceof Error && (
          error.message.includes('429') ||
          error.message.includes('503') ||
          error.message.includes('network') ||
          error.message.includes('timeout')
        );
      
      if (!isRetryable) throw error;
      
      const delay = Math.min(baseDelay * Math.pow(2, attempt - 1), 30000);
      console.log(`Retry attempt ${attempt} after ${delay}ms`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  throw new Error('Unexpected: retryWithBackoff exhausted retries');
}
```

#### 2.2 –°–æ–∑–¥–∞—Ç—å health check endpoint
**–§–∞–π–ª:** `supabase/functions/health-check/index.ts`

```typescript
export const handler = async () => {
  const checks = {
    timestamp: new Date().toISOString(),
    sunoApiKey: Boolean(Deno.env.get('SUNO_API_KEY')),
    replicateApiKey: Boolean(Deno.env.get('REPLICATE_API_KEY')),
    supabaseUrl: Boolean(Deno.env.get('SUPABASE_URL')),
    supabaseServiceRole: Boolean(Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')),
    // Test database connection
    database: await testDatabaseConnection(),
    // Test Suno API
    sunoApi: await testSunoApi(),
  };
  
  const allHealthy = Object.values(checks).every(v => v === true || typeof v === 'object');
  
  return new Response(
    JSON.stringify({ healthy: allHealthy, checks }),
    { 
      status: allHealthy ? 200 : 503,
      headers: { 'Content-Type': 'application/json' }
    }
  );
};
```

#### 2.3 –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ UI
**–§–∞–π–ª:** `src/components/MusicGenerator.tsx`

–î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:
```typescript
if (error.message.includes('SUNO_API_KEY not configured')) {
  toast({
    title: '‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏',
    description: 'API –∫–ª—é—á Suno –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.',
    variant: 'destructive'
  });
} else if (error.message.includes('402') || error.message.includes('Payment')) {
  toast({
    title: 'üí≥ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤',
    description: '–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å API –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Suno.',
    variant: 'destructive'
  });
}
// ... –∏ —Ç.–¥.
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –°–†–ï–î–ù–ò–ô (–≤ —Ç–µ—á–µ–Ω–∏–µ 2 –Ω–µ–¥–µ–ª—å)

#### 3.1 –°–æ–∑–¥–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –ø–∞–Ω–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É `/workspace/diagnostics` —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö API –∫–ª—é—á–µ–π
- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 3.2 –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Sentry –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Supabase Dashboard
- –°–æ–∑–¥–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

#### 3.3 –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è API Service
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–∫–æ–≤
- E2E —Ç–µ—Å—Ç—ã –¥–ª—è UI flow

---

## üìà –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê

–î–ª—è –æ—Ü–µ–Ω–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:

1. **–ë–∞–ª–∞–Ω—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ 100% —Å–ª—É—á–∞–µ–≤ (–¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ)
   - ‚úÖ –í–∏–¥–∏–º –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (desktop + mobile)

2. **–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π —Ç—Ä–µ–∫–æ–≤:**
   - üéØ –¶–µ–ª–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: 100% –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å–æ–∑–¥–∞—é—Ç 2 –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ Suno –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 2)
   - üìä –¢–µ–∫—É—â–∏–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫–æ–≤:**
   - üéØ –¶–µ–ª–µ–≤–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: >95% —É—Å–ø–µ—à–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
   - üìä –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞: <60 —Å–µ–∫—É–Ω–¥ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
   - üìä –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫: <5%

---

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **TypeScript –æ—à–∏–±–∫–∏ –≤ Deno —Ñ–∞–π–ª–∞—Ö** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Deno runtime
2. **Retry –ª–æ–≥–∏–∫–∞ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** - –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
3. **–ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å Sentry
4. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Supabase Dashboard** - –Ω—É–∂–Ω–∞ UI –ø–∞–Ω–µ–ª—å

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Å–µ–≥–æ–¥–Ω—è)
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –ª–æ–≥–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Environment Variables –≤ Supabase
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å Suno API –∞–∫–∫–∞—É–Ω—Ç–∞

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è)
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –ª–æ–≥–∏–∫—É
2. –°–æ–∑–¥–∞—Ç—å health check endpoint
3. –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ UI

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞)
1. –°–æ–∑–¥–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –ø–∞–Ω–µ–ª—å
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
3. –ù–∞–ø–∏—Å–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ API endpoints

---

## üîó –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](../docs/ARCHITECTURE.md)
- [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Suno API](../docs/integrations/SUNO_API_AUDIT.md)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫](../docs/TROUBLESHOOTING_TRACKS.md)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
